# 戦国立身出世SLG_設計書_v0.7_経済系

---

## 1. 文書情報

**文書名**: 戦国立身出世SLG_設計書_v0.7_経済系  
**対象バージョン**: v0.7  
**作成者**: Antigravity  
**作成日**: 2025-11-30  
**準拠文書**: 
- 戦国立身出世SLG v0.7 要件定義書（正式版）
- 別紙H：内政・産業・商人・交易システム（正式版 1.0）
- 別紙M：時間進行・行動管理（修正版 v0.5準拠）
- 別紙D：公務と私事（知行）システム（正式版 1.0）
- 別紙G：軍事システム（正式版 1.0）

### 1-1. 文書の目的

本設計書は、v0.7で実装する経済系システム（内政・産業・商人・交易）のロジック・データ構造・処理フローを定義する。

**目的**:
- データモデルの明確化
- ゲームロジックの数式化・条件式化
- 時間進行との統合仕様の確定
- 他システムとのインターフェース定義

### 1-2. 文書の非目的（明確な除外事項）

本設計書は以下を**一切扱わない**:
- UI設計（画面構成・レイアウト・HTML・CSS）→ Windsurf担当
- UI実装（XAML・コンポーネント）→ Windsurf担当
- 具体的な実装コード → 実装フェーズで対応
- v0.7要件に含まれない拡張機能（名産品質ランク、街道経済圏AI等）

---

## 2. 対象範囲（Scope）

### 2-1. v0.7で実装する機能（ベース機能）

1. **村/町システム**
   - 村パラメータ（人口・治安・税収・産業枠・道路レベル）
   - 村 → 町 昇格ロジック（月次判定）
   - 町の常駐商人誘致

2. **産業システム**
   - 産業スロット（1〜3枠の自由配置）
   - 産業カテゴリ（農業・鍛冶・織物・醸造・鉱山）
   - 産業成長ロジック（日次進捗加算・月次レベルアップ）

3. **名産システム（基礎版）**
   - 名産5種（名刀・名酒・名織物・名薬・名陶）
   - 名産生成条件（産業Lv・月次イベント）
   - 名産効果（信用ボーナス・高額収入）

4. **商人システム**
   - 行商（村レベル）
   - 常駐商人（町レベル）
   - 商人信用システム（個別管理）
   - 行商 → 常駐商人 誘致ロジック

5. **経済 → 軍事 連動**
   - 調達速度計算式
   - 武装レベル上限補正

6. **時間進行統合**
   - 日/旬/月の経済フェイズ処理
   - 私事コマンドとの統合

### 2-2. v0.7では実装しない拡張機能（将来対応）

以下は v0.8以降に実装:
- 名産品質ランク（上・中・下）
- 街道経済圏AI（物流・供給量・市場規模）
- 地方商人・都市商人の本格AI
- 村間連鎖（隣接ボーナス）
- 資源システム（木材・鉄・米の詳細管理）
- 産業枠の5枠拡張（町レベル）

---

## 3. 用語定義

### 3-1. 経済系用語

| 用語 | 定義 |
|------|------|
| **村** | 最小の行政・経済単位。プレイヤーの知行地の基本単位。 |
| **町** | 村が一定条件を満たして昇格した中規模経済単位。常駐商人が配置可能。 |
| **産業枠** | 村が持つ産業スロット（1〜3）。任意の産業カテゴリを配置可能。 |
| **産業カテゴリ** | 農業・鍛冶・織物・醸造・鉱山の5種類。 |
| **産業レベル** | 各産業スロットの成長段階。レベルが上がると生産性・名産条件が向上。 |
| **名産** | 村の特産品。高額収入・商人信用ボーナスを得られる。 |
| **行商** | 村レベルで来訪する商人。個別に信用値を持つ。 |
| **常駐商人** | 町レベルで配置される商人。行商から誘致される。 |
| **信用値** | 商人個別に蓄積されるパラメータ。取引額・回数で増加。 |
| **信用ランク** | 信用値に基づく3段階（面識・常連・上客）。 |
| **道路レベル** | 道/街道の2段階。商人来訪率に影響。 |
| **街道フラグ** | 道路レベルが「街道」の状態。商人来訪率+30%。 |

### 3-2. 別紙定義語（引用）

| 用語 | 定義（別紙より） |
|------|------|
| **公務** | 主君・上司の命令による仕事。功績が増える。（別紙D） |
| **私事** | 自家の領地を富ませる活動。金・資源が増える。（別紙D） |
| **功績** | 出世ポイント。公務・戦功で増加。（別紙D） |
| **調達速度** | 軍事装備の入手速度。経済力で変動。（別紙G） |
| **武装レベル** | 部隊の装備品質。経済力で上限が変動。（別紙G） |

---

## 4. システム全体構成（Overview）

### 4-1. v0.7経済システムの位置づけ

```
┌─────────────────────────────────────┐
│         時間進行（別紙M）           │
│  日 → 旬（10日）→ 月（30日）       │
└─────────┬───────────────────────┘
          │
          ├─→ 公務（別紙D）→ 功績 → 出世
          │
          └─→ 私事（別紙D）→ v0.7経済システム
                              │
                              ├─→ 村/町システム
                              ├─→ 産業システム
                              ├─→ 名産システム
                              ├─→ 商人システム
                              │
                              └─→ 経済 → 軍事（別紙G）
                                    ├─ 調達速度
                                    └─ 武装レベル上限
```

### 4-2. 公務と私事の完全分離

**v0.7の基本原則**（別紙D準拠）:
- 公務 = 功績（出世）
- 私事 = 富（経済）
- **公務と私事は絶対に混ざらない**

経済システムは100%「私事」側の領域。
ただし、経済で得た富により軍事力が向上し、結果的に公務での成功率が上がる。

### 4-3. 経済 → 軍事 → 出世 の接続点

v0.7で実装する連動:
1. **経済 → 軍事**: 調達速度・武装レベル上限の計算式
2. **軍事 → 出世**: 戦功による功績加算（既存システム）

v0.7では「経済 → 出世」の直接連動は**実装しない**。

---

## 5. データモデル設計

### 5-1. Village（村/町）

```csharp
class Village
{
    // 基本情報
    string Id;                    // 村ID
    string Name;                  // 村名
    VillageType Type;             // 村 or 町（enum）
    
    // 人口・治安
    int Population;               // 人口
    int Security;                 // 治安（0〜100）
    
    // 経済
    int TaxIncome;                // 税収（月次）
    int Money;                    // 村の蓄積金
    
    // 産業
    IndustrySlot[] IndustrySlots; // 産業枠（1〜3、町は将来5まで拡張可）
    
    // 名産
    int MeisanProgress;           // 名産進捗（0〜100）
    Meisan? CurrentMeisan;        // 現在の名産（nullなら未生成）
    
    // 道路
    RoadLevel RoadLevel;          // 道/街道（enum）
    
    // 商人
    List<Merchant> MerchantsVisiting;   // 行商リスト（村）
    List<Merchant> MerchantsStationed;  // 常駐商人リスト（町のみ）
    
    // 昇格条件チェック用
    int TotalTradeCount;          // 累計取引回数
}

enum VillageType { Village, Town }
enum RoadLevel { Road, Highway }
```

### 5-2. IndustrySlot（産業スロット）

```csharp
class IndustrySlot
{
    string Id;                    // スロットID
    IndustryType Type;            // 産業種類（enum）
    int Level;                    // レベル（1〜10）
    int Progress;                 // 進捗（0〜100）
    
    // パラメータ（産業種類により異なる）
    Dictionary<string, int> Parameters;  // 拡張用
}

enum IndustryType
{
    Agriculture,  // 農業
    Smithing,     // 鍛冶
    Weaving,      // 織物
    Brewing,      // 醸造
    Mining        // 鉱山
}
```

### 5-3. Meisan（名産）

```csharp
class Meisan
{
    string Id;                    // 名産ID
    MeisanType Type;              // 名産種類（enum）
    string Name;                  // 名産名
    
    // 生成条件（参照用）
    IndustryType RequiredIndustry;  // 必要産業
    int RequiredLevel;              // 必要レベル
    
    // 効果
    int CreditBonus;              // 信用ボーナス（+10〜+30）
    float PriceMultiplier;        // 価格倍率（1.5〜3.0）
}

enum MeisanType
{
    MeiTo,        // 名刀（鍛冶）
    MeiShu,       // 名酒（農業+醸造）
    MeiOrimono,   // 名織物（織物）
    MeiYaku,      // 名薬（鉱山）
    MeiTou        // 名陶（工芸扱い・拡張）
}
```

### 5-4. Merchant（商人）

```csharp
class Merchant
{
    string Id;                    // 商人ID
    string Name;                  // 商人名
    MerchantTier Tier;            // 階層（enum）
    
    // 信用
    int Credit;                   // 信用値（0〜100）
    CreditRank CreditRank;        // 信用ランク（enum）
    
    // 取引履歴
    int TotalTradeAmount;         // 累計取引額
    int TotalTradeCount;          // 累計取引回数
    
    // 商品
    List<Product> ProductList;    // 扱う商品リスト
    Dictionary<string, int> Inventory;  // 在庫
    
    // 行商専用
    int VisitFrequency;           // 来訪頻度（日数）
    int NextVisitDay;             // 次回来訪日
}

enum MerchantTier
{
    Traveling,    // 行商（村）
    Town,         // 街商人（町）
    Regional,     // 地方商人（拡張）
    City          // 都市商人（拡張）
}

enum CreditRank
{
    Acquaintance, // 面識（0〜30）
    Regular,      // 常連（31〜60）
    VIP           // 上客（61〜100）
}

class Product
{
    string Id;
    string Name;
    int BasePrice;
    ProductCategory Category;
}

enum ProductCategory
{
    Food,         // 食料
    Material,     // 資材
    Weapon,       // 武具
    Luxury        // 贅沢品
}
```

---

## 6. ゲームロジック（仕様定義）

### 6-1. 村 → 町 昇格ロジック

**判定タイミング**: 月次処理

**昇格条件**（AND条件）:
```
人口 >= 100
AND 産業合計レベル >= 2
AND 累計取引回数 >= 10
AND 治安 >= 50
```

**昇格時の処理**:
1. `Village.Type` を `Town` に変更
2. `MerchantsStationed` リストを初期化
3. 行商から常駐商人誘致判定を実行（後述）
4. ログ出力: 「{村名}が町に昇格しました」

**パラメータ調整可能性**:
- 人口閾値: 100（調整可）
- 産業レベル合計: 2（調整可）
- 取引回数: 10（調整可）
- 治安閾値: 50（調整可）

### 6-2. 産業成長ロジック

#### 6-2-1. 日次処理（私事「産業開発」実行時）

**進捗加算式**:
```
Progress += BaseGrowth * PlayerAbility * AdvisorBonus

BaseGrowth = 10（基礎値）
PlayerAbility = (Player.AbilityPolitics / 100)
AdvisorBonus = 1.0 + (Advisor.AbilityPolitics - Player.AbilityPolitics) * 0.4 / 100
```

**例**:
- プレイヤー政務60、補佐官政務80の場合
- AdvisorBonus = 1.0 + (80-60) * 0.4 / 100 = 1.08
- Progress += 10 * 0.6 * 1.08 = 6.48 ≒ 6

#### 6-2-2. 月次処理（レベルアップ判定）

**レベルアップ条件**:
```
IF Progress >= LevelUpThreshold THEN
    Level += 1
    Progress -= LevelUpThreshold
END IF
```

**LevelUpThreshold（レベル別）**:
```
Level 1→2: 100
Level 2→3: 150
Level 3→4: 200
Level 4→5: 250
Level 5以降: 300 + (Level-5) * 50
```

**レベル上限**: 10

### 6-3. 名産生成ロジック

#### 6-3-1. 名産候補発生条件

**月次判定**:
```
FOR EACH IndustrySlot IN Village.IndustrySlots
    IF Slot.Level >= MeisanRequiredLevel[Slot.Type]
       AND Village.CurrentMeisan == null
       AND Random(0,100) < MeisanEventProbability THEN
        名産候補イベント発生
    END IF
END FOR
```

**MeisanRequiredLevel**（産業種類別）:
```
農業: Level 3
鍛冶: Level 4
織物: Level 3
醸造: Level 3
鉱山: Level 5
```

**MeisanEventProbability**: 20%（月次）

#### 6-3-2. 名産承認処理

プレイヤーが名産候補イベントを承認した場合:
```
Village.CurrentMeisan = new Meisan(Type, Name, ...)
Village.MeisanProgress = 100
ログ出力: 「{名産名}が完成しました」
```

#### 6-3-3. 名産効果

**信用ボーナス**:
```
名産あり: Credit += 10〜30（名産種類による）
```

**価格倍率**:
```
名産品の販売価格 = BasePrice * (1.5〜3.0)
```

**商人来訪率UP**:
```
名産あり: 行商来訪確率 +20%
```

### 6-4. 商人信用ロジック

#### 6-4-1. 信用値計算式

**取引時の信用増加**:
```
CreditGain = (TradeAmount / 100) + (TradeCount * 2) + MeisanBonus

TradeAmount: 今回の取引額
TradeCount: 累計取引回数（1回につき+2）
MeisanBonus: 名産ありなら+10〜+30
```

**信用値更新**:
```
Merchant.Credit += CreditGain
Merchant.Credit = Clamp(Merchant.Credit, 0, 100)
```

#### 6-4-2. 信用ランク判定

```
IF Credit >= 61 THEN CreditRank = VIP
ELSE IF Credit >= 31 THEN CreditRank = Regular
ELSE CreditRank = Acquaintance
```

#### 6-4-3. 信用ランク効果

| ランク | 手数料 | 卸売 | 高級商品 | 支払猶予 |
|--------|--------|------|----------|----------|
| 面識   | 20%    | 不可 | 不可     | 不可     |
| 常連   | 10%    | 可   | 一部可   | 不可     |
| 上客   | 5%     | 可   | 可       | 可       |

### 6-5. 行商 → 常駐商人 誘致ロジック

**誘致判定タイミング**: 町昇格時

**誘致条件**:
```
FOR EACH Merchant IN Village.MerchantsVisiting
    IF Merchant.CreditRank >= Regular THEN
        誘致候補に追加
    END IF
END FOR
```

**誘致処理**:
```
プレイヤーが誘致候補から1名選択
→ MerchantsVisiting から削除
→ MerchantsStationed に追加
→ Merchant.Tier = Town に変更
```

**常駐商人の効果**:
- 毎日取引可能（行商は来訪時のみ）
- 商品在庫が豊富
- 手数料が行商より低い

### 6-6. 経済 → 軍事 連動（v0.7ベース）

#### 6-6-1. 調達速度計算式

**調達速度**（装備入手までの日数）:
```
AcquisitionDays = BaseAcquisitionDays / EconomicPower

BaseAcquisitionDays = 30（基礎値）
EconomicPower = 1.0 + (TotalIndustryLevel / 10) + (MerchantCreditAvg / 100)

TotalIndustryLevel: 全産業スロットのレベル合計
MerchantCreditAvg: 全商人の平均信用値
```

**例**:
- 産業レベル合計10、商人平均信用50の場合
- EconomicPower = 1.0 + 1.0 + 0.5 = 2.5
- AcquisitionDays = 30 / 2.5 = 12日

#### 6-6-2. 武装レベル上限補正

**武装レベル上限**:
```
MaxArmorLevel = BaseMaxLevel + EconomicBonus

BaseMaxLevel = 3
EconomicBonus = Floor(TotalIndustryLevel / 5) + (HasMeisan ? 1 : 0)
```

**例**:
- 産業レベル合計12、名産ありの場合
- EconomicBonus = Floor(12/5) + 1 = 2 + 1 = 3
- MaxArmorLevel = 3 + 3 = 6

---

## 7. 時間進行との統合（別紙M準拠）

### 7-1. 日次処理

**タイミング**: 毎日の行動選択後

**処理内容**:
1. **私事「産業開発」実行時**:
   - 対象産業スロットの Progress 加算（6-2-1参照）
   
2. **私事「商人取引」実行時**:
   - 取引処理
   - 商人信用値更新（6-4-1参照）
   
3. **私事「名産開発」実行時**:
   - MeisanProgress 加算（+10）
   
4. **行商来訪・退去チェック**:
   - 各行商の NextVisitDay をチェック
   - 来訪日なら MerchantsVisiting に追加
   - 滞在期間終了なら削除

### 7-2. 旬次処理（10日ごと）

**タイミング**: 日数 % 10 == 0

**処理内容**:
1. **商人価格変動**:
   - 各商品の BasePrice を ±10% ランダム変動
   
2. **村治安変動**:
   - Security += Random(-5, +5)
   - Clamp(Security, 0, 100)

### 7-3. 月次処理

**タイミング**: 月末（30日目）

**処理内容**（実行順序）:
1. **産業レベル判定**（6-2-2参照）
2. **名産候補イベント**（6-3-1参照）
3. **商人信用集計**（既に日次で更新済み）
4. **村 → 町 昇格判定**（6-1参照）
5. **常駐商人誘致判定**（町のみ、6-5参照）
6. **税収計算**:
   ```
   TaxIncome = Population * 0.1 + TotalIndustryLevel * 5
   Village.Money += TaxIncome
   ```
7. **行商再来訪スケジュール更新**:
   ```
   FOR EACH Merchant IN MerchantsVisiting
       Merchant.NextVisitDay = CurrentDay + Merchant.VisitFrequency
   END FOR
   ```

### 7-4. 処理フロー図

```
日次ループ
  ├─ プレイヤー行動選択（公務 or 私事）
  │   └─ 私事選択時 → 経済システム処理
  │       ├─ 産業開発 → Progress加算
  │       ├─ 商人取引 → Credit更新
  │       └─ 名産開発 → MeisanProgress加算
  │
  ├─ 行商来訪・退去チェック
  │
  └─ 日数カウント
      │
      ├─ 10日ごと（旬次）
      │   ├─ 商人価格変動
      │   └─ 村治安変動
      │
      └─ 30日ごと（月次）
          ├─ 産業レベル判定
          ├─ 名産候補イベント
          ├─ 村→町昇格判定
          ├─ 常駐商人誘致判定
          ├─ 税収計算
          └─ 行商スケジュール更新
```

---

## 8. 他システムとのインターフェース

### 8-1. 軍事システム（別紙G）

**インターフェース**:
- **Input（経済 → 軍事）**:
  - `TotalIndustryLevel`: 全産業レベル合計
  - `MerchantCreditAvg`: 商人平均信用値
  - `HasMeisan`: 名産の有無
  
- **Output（軍事側で使用）**:
  - `AcquisitionDays`: 調達速度（6-6-1参照）
  - `MaxArmorLevel`: 武装レベル上限（6-6-2参照）

**実装方針**:
- 軍事システム側で経済パラメータを参照
- 経済システムは軍事システムに直接影響を与えない（疎結合）

### 8-2. 評価・出世ロジック（v0.7では参照のみ）

**インターフェース**:
- **Input（経済 → 出世）**: なし（v0.7では直接連動なし）
- **Output（出世側で使用）**: なし

**将来拡張**（v0.8以降）:
- 家格評価に経済力を反映
- 名産による名声ボーナス

### 8-3. 公務/私事システム（別紙D）

**インターフェース**:
- **Input（私事 → 経済）**:
  - 私事コマンド選択（産業開発・商人取引・名産開発）
  - プレイヤー能力値（Politics）
  - 補佐官能力値（Politics）
  
- **Output（経済側で処理）**:
  - Progress加算
  - Credit更新
  - MeisanProgress加算

**実装方針**:
- 私事コマンド実行時に経済システムの対応メソッドを呼び出し
- 公務コマンドは経済システムに一切影響しない

---

## 9. 設計ポリシー（将来拡張のためのフック）

### 9-1. 街道経済圏（物流・供給量・地域集積）

**フック設計**:
- `Village.RoadLevel` を拡張可能な enum で定義
- 将来的に `EconomicZone` クラスを追加可能
- 商人来訪率計算式に `ZoneBonus` パラメータを追加可能

**実装しない内容**（v0.7）:
- 地域間物流シミュレーション
- 供給量・需要量の動的計算
- 経済圏AIによる価格変動

### 9-2. 名産品質ランク

**フック設計**:
- `Meisan` クラスに `QualityRank` フィールドを追加可能
- 品質ランクによる価格倍率・信用ボーナスの変動

**実装しない内容**（v0.7）:
- 品質ランクの判定ロジック
- 品質向上イベント

### 9-3. 商人AI（地方/都市商人）

**フック設計**:
- `MerchantTier` enum に `Regional`, `City` を定義済み
- `Merchant` クラスは階層拡張に対応

**実装しない内容**（v0.7）:
- 地方商人・都市商人の本格AI
- 商人の自律的な価格設定・在庫管理

### 9-4. 村間連鎖（隣接ボーナス）

**フック設計**:
- `Village` クラスに `List<string> AdjacentVillageIds` フィールドを追加可能
- 隣接村の産業レベルによるボーナス計算

**実装しない内容**（v0.7）:
- 隣接村の判定ロジック
- 隣接ボーナスの計算式

---

## 10. パラメータ調整用テーブル

### 10-1. 産業成長パラメータ

| パラメータ | 初期値 | 調整可能範囲 | 備考 |
|------------|--------|--------------|------|
| BaseGrowth | 10 | 5〜20 | 日次進捗加算の基礎値 |
| LevelUpThreshold (Lv1→2) | 100 | 50〜200 | レベルアップ必要進捗 |
| LevelUpThreshold (Lv2→3) | 150 | 100〜300 | レベルアップ必要進捗 |
| LevelUpThreshold (Lv3→4) | 200 | 150〜400 | レベルアップ必要進捗 |

### 10-2. 名産生成パラメータ

| パラメータ | 初期値 | 調整可能範囲 | 備考 |
|------------|--------|--------------|------|
| MeisanEventProbability | 20% | 10〜50% | 月次名産候補発生確率 |
| MeisanRequiredLevel (農業) | 3 | 2〜5 | 名産生成必要レベル |
| MeisanRequiredLevel (鍛冶) | 4 | 3〜6 | 名産生成必要レベル |
| MeisanRequiredLevel (織物) | 3 | 2〜5 | 名産生成必要レベル |
| MeisanRequiredLevel (醸造) | 3 | 2〜5 | 名産生成必要レベル |
| MeisanRequiredLevel (鉱山) | 5 | 4〜7 | 名産生成必要レベル |

### 10-3. 商人信用パラメータ

| パラメータ | 初期値 | 調整可能範囲 | 備考 |
|------------|--------|--------------|------|
| CreditGain (取引額) | TradeAmount / 100 | /50〜/200 | 取引額による信用増加 |
| CreditGain (取引回数) | TradeCount * 2 | *1〜*5 | 取引回数による信用増加 |
| MeisanBonus | 10〜30 | 5〜50 | 名産による信用ボーナス |
| CreditRank閾値 (常連) | 31 | 20〜50 | 信用ランク判定 |
| CreditRank閾値 (上客) | 61 | 50〜80 | 信用ランク判定 |

### 10-4. 村→町昇格パラメータ

| パラメータ | 初期値 | 調整可能範囲 | 備考 |
|------------|--------|--------------|------|
| 人口閾値 | 100 | 50〜200 | 昇格必要人口 |
| 産業レベル合計 | 2 | 1〜5 | 昇格必要産業レベル |
| 累計取引回数 | 10 | 5〜20 | 昇格必要取引回数 |
| 治安閾値 | 50 | 30〜70 | 昇格必要治安 |

### 10-5. 調達速度補正係数

| パラメータ | 初期値 | 調整可能範囲 | 備考 |
|------------|--------|--------------|------|
| BaseAcquisitionDays | 30 | 20〜60 | 基礎調達日数 |
| IndustryLevelCoefficient | 1/10 | 1/5〜1/20 | 産業レベルの影響度 |
| MerchantCreditCoefficient | 1/100 | 1/50〜1/200 | 商人信用の影響度 |

---

## 11. 完了宣言

本設計書は、v0.7経済系システムの設計を完了した。

**設計完了内容**:
- データモデル定義（Village, IndustrySlot, Meisan, Merchant）
- ゲームロジック仕様（村→町昇格、産業成長、名産生成、商人信用、経済→軍事連動）
- 時間進行統合（日/旬/月の処理フロー）
- 他システムとのインターフェース定義
- 将来拡張のためのフック設計
- パラメータ調整用テーブル

**実装への移行について**:
本設計書に基づき、実装フェーズに進むことが可能。
ただし、本設計書の作成者（Antigravity）は**実装には進まず**、設計書の完成をもって処理を停止する。

実装は別途、実装担当者が本設計書を参照して進めること。

**UI設計について**:
UI設計・実装は Windsurf が担当。
本設計書はロジック・データ構造のみを定義しており、UI仕様は一切含まない。

---

**設計書作成完了日**: 2025-11-30  
**作成者**: Antigravity  
**ステータス**: 完了・実装待機

---
