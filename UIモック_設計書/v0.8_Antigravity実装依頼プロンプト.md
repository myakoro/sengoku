# v0.8 UI実装依頼（Antigravity向け）

## 📋 前提条件

この実装は、以下の仕様書に基づいています。**必ず参照してください。**

1. **`仕様書_v0.8.md`** - v0.8の詳細仕様（データ構造、ロジック、UIロジック）
2. **`v0.8 要件定義書（婚姻・縁談・世代交代）.txt`** - v0.8の要件定義

これらの仕様書を理解した上で、以下のUIモックをWPFで実装してください。

---

## 🎯 実装依頼の概要

以下の4つのHTML/CSSモックを、WPF（MVVM）で実装してください。
**途中で許可を求めず、テスト完了まで自動で進めてください。**

---

## 📁 実装対象ファイル

### 1. メイン画面（v0.8通知要素追加版）
- **モックファイル**: `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_メイン画面_通知サンプル.html`
- **実装先**: 既存の`MainView.xaml`に通知要素を追加
- **重要**: 既存のメイン画面を壊さず、v0.8の通知要素のみを追加してください

### 2. 婚姻候補一覧画面
- **モックファイル**: `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_婚姻候補一覧画面.html`
- **実装先**: `Views\MarriageCandidateListView.xaml` + `ViewModels\MarriageCandidateListViewModel.cs`

### 3. 婚姻交渉画面
- **モックファイル**: `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_婚姻交渉画面.html`
- **実装先**: `Views\MarriageNegotiationView.xaml` + `ViewModels\MarriageNegotiationViewModel.cs`

### 4. 世代交代イベント画面
- **モックファイル**: `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_世代交代イベント画面.html`
- **実装先**: `Views\SuccessionEventView.xaml` + `ViewModels\SuccessionEventViewModel.cs`

---

## 📋 実装要件

### 基本方針
1. **HTML/CSSモックの見た目を忠実に再現**してください
2. **WPF MVVM パターン**で実装してください
3. **既存のv0.7スタイル**（和風UI）を踏襲してください
4. **ダミーデータ**を使用して動作確認できる状態にしてください
5. **途中で許可を求めず、テスト完了まで自動で進めてください**

### 技術スタック
- **WPF** (.NET 6 or later)
- **MVVM パターン** (CommunityToolkit.Mvvm 推奨)
- **XAML** でUI定義
- **C#** でViewModel実装

### スタイル要件
- **色**: 既存の和風カラーパレット（`#8b6f47`, `#f8f3e7`, `#d4a017`, `#c73940`, `#1d3557`）
- **フォント**: 游明朝 (Yu Mincho) または MS 明朝
- **レイアウト**: HTML/CSSモックと同じグリッドレイアウト

---

## 🔧 各画面の実装詳細

### 1. メイン画面（v0.8通知要素追加）

#### 追加するUI要素
1. **左ナビゲーション「家族」ボタンに通知バッジ**
   - 赤い丸バッジ（数字「3」）
   - 婚姻候補が来ている時に表示

2. **左ナビゲーション「公務」ボタンに通知アイコン**
   - 黄色い「！」アイコン
   - 元服可能な子供がいる時に表示

3. **ヘッダー当主情報に世代交代インジケータ**
   - 年齢表示の横に「⚠」アイコン
   - 当主が高齢（55歳以上）の時に表示

4. **右サイドバー「今月の出来事」セクション**
   - コンパクトなイベントログ
   - 元服通知、婚姻候補通知などを表示
   - 最大5件程度、スクロール可能

#### 実装方針
- **既存のMainView.xamlを壊さない**
- 通知要素は`Visibility`プロパティでON/OFF切り替え
- ダミーデータで通知が表示されている状態にする

#### ViewModel プロパティ（追加分）
```csharp
public int MarriageOfferCount { get; set; } // 婚姻候補数
public bool HasGenpukuCandidate { get; set; } // 元服可能な子供がいるか
public bool IsLordAging { get; set; } // 当主が高齢か
public ObservableCollection<EventLogItem> RecentEvents { get; set; } // 今月の出来事
```

#### ダミーデータ
```csharp
MarriageOfferCount = 3;
HasGenpukuCandidate = true;
IsLordAging = true;
RecentEvents = new ObservableCollection<EventLogItem>
{
    new EventLogItem { Icon = "👶", Text = "次男 山田次郎が元服しました（徒士に任命）" },
    new EventLogItem { Icon = "💍", Text = "田中家から縁談の申し出が届きました" },
    new EventLogItem { Icon = "💰", Text = "商人 山本屋との取引で500貫の利益" }
};
```

---

### 2. 婚姻候補一覧画面 (`MarriageCandidateListView`)

#### UI要素
- **ヘッダー**: タイトル「【婚姻候補一覧】」+ 現在のオファー件数
- **テーブル**: 8カラム（区分、相手家、対象者、家格、役職、持参金、人脈紹介、操作）
- **ボタン**: 各行に「詳細」「交渉」ボタン、下部に「戻る」ボタン
- **注意事項**: 婚姻の効果説明

#### ViewModel プロパティ
```csharp
public ObservableCollection<MarriageCandidateViewModel> Candidates { get; set; }
public int OfferCount { get; set; }
public ICommand ViewDetailsCommand { get; set; }
public ICommand StartNegotiationCommand { get; set; }
public ICommand BackCommand { get; set; }
```

#### ダミーデータ
```csharp
// 3件の縁談候補（田中家・正室、山田家・側室、佐藤家・正室）
// HTML内のデータと同じ内容を使用
```

---

### 3. 婚姻交渉画面 (`MarriageNegotiationView`)

#### UI要素
- **ヘッダー**: タイトル「【婚姻交渉】」+ 相手情報（家名、対象者名、家格）
- **3カラムレイアウト**:
  - **左**: 持参金スライダー（0-1000貫）
  - **中央**: 人脈紹介チェックボックスリスト（商人、寺社、武将）
  - **右**: 成功率表示（大きな数字 + プログレスバー + 内訳）
- **ボタン**: 「戻る」「交渉する」

#### ViewModel プロパティ
```csharp
public string OpponentHouseName { get; set; }
public string OpponentPersonName { get; set; }
public int OpponentHouseRank { get; set; }
public int DowryAmount { get; set; } // 0-1000
public ObservableCollection<ConnectionOption> Connections { get; set; }
public int SuccessRate { get; set; } // 計算結果
public ICommand NegotiateCommand { get; set; }
public ICommand BackCommand { get; set; }
```

#### ロジック
- **成功率計算**: `DowryAmount`と選択された`Connections`に応じて動的に計算
- **基本スコア**: 50%
- **持参金補正**: 500貫で+10%（比例計算）
- **人脈補正**: 各チェックボックスの`BonusRate`を加算

#### ダミーデータ
```csharp
// 田中家 田中花子（家格50）
// 人脈: 商人 山本屋(+5%), 寺社 善光寺(+3%), 武将 鈴木一郎(+10%)
```

---

### 4. 世代交代イベント画面 (`SuccessionEventView`)

#### UI要素
- **ヘッダー**: タイトル「【世代交代】」+ 前当主→新当主の遷移表示 + 世代数
- **2カラムレイアウト**:
  - **左**: パラメータ継承（2x3グリッド）+ 新当主役職ボックス
  - **右**: 家中忠誠変化テーブル（家臣名、変動前、変動値、変動後）
- **ボタン**: 「次へ」

#### ViewModel プロパティ
```csharp
public string FormerLordName { get; set; }
public string NewLordName { get; set; }
public int Generation { get; set; }
public InheritanceData Inheritance { get; set; }
public string NewLordRank { get; set; }
public string RankReason { get; set; }
public ObservableCollection<LoyaltyChange> LoyaltyChanges { get; set; }
public ICommand NextCommand { get; set; }
```

#### ダミーデータ
```csharp
// 山田 太郎 → 山田 次郎（第3代当主）
// 継承: 家格80→80(100%), 貸借50→30(60%), 商人信用70→63(90%), 寺社信用60→54(90%), 人脈15→15(100%), 世代2→3
// 新当主役職: 徒士（親の威光: 部将-2段階）
// 家臣8名の忠誠変化（全員-10）
```

---

## 🎨 スタイルガイド

### 共通スタイル
```xml
<!-- 和風カラーパレット -->
<Color x:Key="WafuBrown">#8b6f47</Color>
<Color x:Key="WafuBeige">#f8f3e7</Color>
<Color x:Key="WafuGold">#d4a017</Color>
<Color x:Key="WafuRed">#c73940</Color>
<Color x:Key="WafuNavy">#1d3557</Color>
<Color x:Key="WafuLightBeige">#fff8dc</Color>
<Color x:Key="WafuBorder">#8b4513</Color>

<!-- フォント -->
<FontFamily x:Key="WafuFont">Yu Mincho, MS Mincho</FontFamily>
```

### ボタンスタイル
- **プライマリボタン**: 紺色グラデーション（`#1d3557` → `#2a4a6b`）、白文字
- **セカンダリボタン**: ベージュ（`#f0e6d2`）、黒文字
- **ホバー効果**: 色反転またはわずかに明るく

### テーブルスタイル
- **ヘッダー**: 茶色グラデーション（`#8b6f47`）、白文字
- **行**: 交互背景色、ホバーで`#f0e6d2`
- **ボーダー**: `#8b4513`

---

## ✅ 実装チェックリスト

### 必須実装項目
- [ ] **メイン画面**: 既存MainView.xamlに通知要素を追加
- [ ] **メイン画面**: 通知バッジ、アイコン、イベントログの実装
- [ ] **婚姻候補一覧**: XAMLファイル作成
- [ ] **婚姻候補一覧**: ViewModelファイル作成
- [ ] **婚姻交渉**: XAMLファイル作成
- [ ] **婚姻交渉**: ViewModelファイル作成
- [ ] **世代交代**: XAMLファイル作成
- [ ] **世代交代**: ViewModelファイル作成
- [ ] ダミーデータの実装（全画面）
- [ ] コマンドの実装（ボタンクリック処理）
- [ ] データバインディングの設定
- [ ] スタイルの適用（和風UI）
- [ ] レイアウトの再現（HTML/CSSモックと同じ）

### 動的機能
- [ ] **メイン画面**: 通知バッジの表示/非表示切り替え（Visibilityバインディング）
- [ ] **メイン画面**: イベントログのスクロール
- [ ] **婚姻交渉画面**: スライダー変更時の成功率自動計算
- [ ] **婚姻交渉画面**: チェックボックス変更時の成功率自動計算
- [ ] **婚姻交渉画面**: 成功率に応じたプログレスバーの色変更（緑/黄/赤）

### テスト項目
- [ ] **メイン画面**: 通知要素が正しく表示される
- [ ] **メイン画面**: 既存機能が壊れていない
- [ ] 各画面が正しく表示される
- [ ] ボタンクリックが動作する（ダミー処理でOK）
- [ ] データバインディングが正しく機能する
- [ ] スライダー/チェックボックスの変更が反映される
- [ ] レイアウトが崩れない

---

## 🚀 実装手順

### ステップ1: プロジェクト構造の確認
既存のWPFプロジェクト構造を確認し、`Views`と`ViewModels`フォルダに新規ファイルを追加してください。

### ステップ2: メイン画面への通知要素追加
既存の`MainView.xaml`と`MainViewModel.cs`に、v0.8の通知要素を追加してください。
- 既存機能を壊さないこと
- 通知バッジ、アイコン、イベントログを追加
- ダミーデータで通知が表示されている状態にする

### ステップ3: 新規画面のViewModelの実装
婚姻候補一覧、婚姻交渉、世代交代の各ViewModelを実装してください。ダミーデータを含めてください。

### ステップ4: 新規画面のXAMLの実装
HTML/CSSモックを参考に、XAMLでUIを実装してください。

### ステップ5: スタイルの適用
和風UIスタイルを適用してください。既存のResourceDictionaryがあれば活用してください。

### ステップ6: テスト
各画面を起動して、表示と動作を確認してください。
- メイン画面の通知要素が表示されるか
- 既存のメイン画面機能が壊れていないか
- 新規画面が正しく表示されるか

### ステップ7: 完了報告
実装完了後、以下を報告してください：
- 実装したファイルのリスト
- 動作確認結果
- スクリーンショット（可能であれば）

---

## 📝 注意事項

### やるべきこと
✅ HTML/CSSモックの見た目を忠実に再現する
✅ ダミーデータで動作確認できる状態にする
✅ MVVMパターンに従う
✅ 既存のv0.7スタイルを踏襲する
✅ **メイン画面の既存機能を壊さない（通知要素のみ追加）**
✅ **途中で許可を求めず、テスト完了まで自動で進める**

### やってはいけないこと
❌ ゲームロジック（成功率の詳細計算、データベース保存など）を実装しない
❌ 仕様書に書かれていないルールを勝手に作らない
❌ 既存のv0.7 UIを理由なく改変しない
❌ **メイン画面の既存機能を削除・変更しない**
❌ **途中で実装の許可を求めない（自動で最後まで進める）**

---

## 📚 参考資料

### 【重要】前提となる仕様書
以下の仕様書を必ず参照してください。これらがv0.8の要件定義の基盤です。

1. **`C:\Users\takuy\Desktop\戦国出世ゲーム\仕様書\仕様書_v0.8.md`**
   - v0.8の詳細仕様（データ構造、ロジック、UIロジック）
   
2. **`C:\Users\takuy\Desktop\戦国出世ゲーム\仕様書\v0.8 要件定義書（婚姻・縁談・世代交代）.txt`**
   - v0.8の要件定義（婚姻システム、子供・元服、世代交代の全体像）

### UIモック
- `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_メイン画面_通知サンプル.html`
- `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_婚姻候補一覧画面.html`
- `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_婚姻交渉画面.html`
- `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_世代交代イベント画面.html`

### スタイルガイド
- `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.7_styles.css`
- `C:\Users\takuy\Desktop\戦国出世ゲーム\UIモック_HTML\v0.8_styles.css`

---

## 🎯 最終ゴール

**ユーザーが以下を確認できる状態**にしてください：

1. **メイン画面**: 既存機能はそのまま + v0.8通知要素が追加されている
2. **婚姻候補一覧画面**: テーブル形式で3件の縁談候補が表示される
3. **婚姻交渉画面**: 3カラムレイアウトで、スライダー/チェックボックス操作で成功率が変動する
4. **世代交代イベント画面**: 2カラムレイアウトで、継承情報と忠誠変化が表示される

すべての画面が**HTML/CSSモックと同じ見た目・操作感**であること。

**途中で許可を求めず、テスト完了まで自動で進めてください。**

以上です。よろしくお願いします！
