# 01_軍事編成画面

**画面ID**: SCR-001  
**優先度**: 🔴 最重要  
**参照設計書**: v0.9 第2章（隊階層構造）

---

## 📋 画面概要

25人・100人・300人の3階層を可視化し、徒士・馬上衆・従僕の構成を管理する画面。  
自動編成と手動入替の両方に対応。

---

## 🎨 画面レイアウト

```
┌─────────────────────────────────────────────────────────┐
│ 【軍事編成】                          [戻る] [保存]      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─ 編成モード ─────────────────────────────────┐       │
│ │ ○ 自動編成  ● 手動編成                       │       │
│ │ [自動編成実行]                                │       │
│ └───────────────────────────────────────────┘       │
│                                                         │
│ ┌─ 階層選択タブ ───────────────────────────────┐       │
│ │ [大隊(300)] [中隊(100)] [小隊(25)]           │       │
│ └───────────────────────────────────────────┘       │
│                                                         │
│ ┌─ 大隊ビュー（300人） ─────────────────────────┐       │
│ │                                               │       │
│ │  足軽大将: 【山田太郎】 指揮上限: 300         │       │
│ │                                               │       │
│ │  ┌─ 中隊A (100) ─────────────────┐          │       │
│ │  │ 組頭: 佐藤次郎                  │          │       │
│ │  │ 小隊: [25][25][25][25]          │          │       │
│ │  │ 状態: 訓練70 士気80 疲労20      │          │       │
│ │  └─────────────────────────────┘          │       │
│ │                                               │       │
│ │  ┌─ 中隊B (100) ─────────────────┐          │       │
│ │  │ 組頭: 鈴木三郎                  │          │       │
│ │  │ 小隊: [25][25][25][25]          │          │       │
│ │  │ 状態: 訓練65 士気75 疲労15      │          │       │
│ │  └─────────────────────────────┘          │       │
│ │                                               │       │
│ │  ┌─ 中隊C (100) ─────────────────┐          │       │
│ │  │ 組頭: 田中四郎                  │          │       │
│ │  │ 小隊: [25][25][25][25]          │          │       │
│ │  │ 状態: 訓練80 士気85 疲労10      │          │       │
│ │  └─────────────────────────────┘          │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 兵種構成 ─────────────────────────────────┐       │
│ │ 徒士: 180人 (60%)                             │       │
│ │ 馬上衆: 90人 (30%) 🐴                         │       │
│ │ 従僕: 30人 (10%)                              │       │
│ │                                               │       │
│ │ [兵種バランス調整]                            │       │
│ └───────────────────────────────────────┘       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 🔧 UI要素詳細

### 1. ヘッダー部
- **画面タイトル**: 「軍事編成」（墨色・ゴシック太字）
- **[戻る]ボタン**: 右上、前画面に戻る
- **[保存]ボタン**: 右上、編成内容を確定

### 2. 編成モード切替
- **ラジオボタン**:
  - `○ 自動編成`: システムが最適配置を計算
  - `● 手動編成`: ユーザーが個別に配置
- **[自動編成実行]ボタン**: 自動編成選択時のみ有効化

### 3. 階層選択タブ
- **[大隊(300)]**: 中隊3つの全体ビュー（デフォルト表示）
- **[中隊(100)]**: 小隊4つの詳細ビュー
- **[小隊(25)]**: 個人ユニット（徒士・馬上衆・従僕）の詳細ビュー

### 4. 大隊ビュー（300人）
#### 4-1. 大隊情報
- **足軽大将名**: 指揮官の名前（朱色・太字）
- **指揮上限**: 300（固定値）

#### 4-2. 中隊カード（3枚）
各中隊カードには以下を表示：
- **組頭名**: 指揮官の名前
- **小隊構成**: `[25][25][25][25]` の4ブロック表示
- **状態バー**:
  - 訓練度: 緑色バー（0〜100）
  - 士気: 青色バー（0〜100）
  - 疲労: 赤色バー（0〜100）

#### 4-3. 中隊カードの色分け
- **訓練度**:
  - 80以上: 濃緑 `#2E7D32`
  - 50〜79: 黄緑 `#7CB342`
  - 50未満: 黄色 `#FBC02D`
- **士気**:
  - 40以上: 青 `#1976D2`
  - 20〜39: 水色 `#4FC3F7`
  - 20未満: 灰色 `#9E9E9E`
- **疲労**:
  - 0〜49: 緑 `#66BB6A`
  - 50〜79: 橙 `#FF9800`
  - 80以上: 赤 `#E53935`

### 5. 兵種構成パネル
- **徒士**: 人数 + 割合（%）
- **馬上衆**: 人数 + 割合（%）+ 馬アイコン🐴
- **従僕**: 人数 + 割合（%）
- **[兵種バランス調整]ボタン**: 兵種比率を変更する別画面へ遷移

---

## 🔄 中隊ビュー（100人）

タブで「中隊(100)」を選択した場合の表示：

```
┌─ 中隊A (100人) ─────────────────────────────────┐
│ 組頭: 佐藤次郎  性格: 標準  指揮上限: 100       │
│                                                  │
│ ┌─ 小隊1 (25) ──┐ ┌─ 小隊2 (25) ──┐        │
│ │ 小頭: 伊藤一   │ │ 小頭: 渡辺二   │        │
│ │ 徒士: 15       │ │ 徒士: 18       │        │
│ │ 馬上衆: 8 🐴   │ │ 馬上衆: 5 🐴   │        │
│ │ 従僕: 2        │ │ 従僕: 2        │        │
│ │ 訓練: ████░ 75 │ │ 訓練: ███░░ 60 │        │
│ │ 士気: ████░ 80 │ │ 士気: ████░ 75 │        │
│ │ 疲労: █░░░░ 15 │ │ 疲労: ██░░░ 25 │        │
│ └────────────────┘ └────────────────┘        │
│                                                  │
│ ┌─ 小隊3 (25) ──┐ ┌─ 小隊4 (25) ──┐        │
│ │ 小頭: 高橋三   │ │ 小頭: 中村四   │        │
│ │ 徒士: 16       │ │ 徒士: 17       │        │
│ │ 馬上衆: 7 🐴   │ │ 馬上衆: 6 🐴   │        │
│ │ 従僕: 2        │ │ 従僕: 2        │        │
│ │ 訓練: ████░ 70 │ │ 訓練: ████░ 78 │        │
│ │ 士気: ███░░ 70 │ │ 士気: ████░ 82 │        │
│ │ 疲労: ██░░░ 20 │ │ 疲労: █░░░░ 10 │        │
│ └────────────────┘ └────────────────┘        │
│                                                  │
│ [ローテーション基準]                             │
│ 性格: 標準 → 疲労80で交代                       │
└──────────────────────────────────────────┘
```

### 中隊ビューの特徴
- **小隊4つを2×2グリッドで表示**
- **各小隊カード**に徒士・馬上衆・従僕の人数を明記
- **状態バー**は5段階の視覚表示（█ = 20%）
- **性格によるローテ基準**を下部に表示
  - 慎重: 疲労70
  - 標準: 疲労80
  - 猪突: 疲労90

---

## 🔄 小隊ビュー（25人）

タブで「小隊(25)」を選択した場合の表示：

```
┌─ 小隊1 (25人) ─────────────────────────────────┐
│ 小頭: 伊藤一郎  指揮上限: 25                    │
│                                                  │
│ ┌─ 個人ユニット一覧 ─────────────────────┐    │
│ │                                          │    │
│ │ 【徒士】(15人)                           │    │
│ │ ┌──────────────────────────┐         │    │
│ │ │ 名前      戦闘力  配置  状態 │         │    │
│ │ ├──────────────────────────┤         │    │
│ │ │ 木村五郎    12    前衛  良好 │         │    │
│ │ │ 林六郎      10    前衛  良好 │         │    │
│ │ │ 斎藤七郎    11    中衛  良好 │         │    │
│ │ │ ...（省略）                  │         │    │
│ │ └──────────────────────────┘         │    │
│ │                                          │    │
│ │ 【馬上衆】(8人) 🐴                       │    │
│ │ ┌──────────────────────────┐         │    │
│ │ │ 名前      戦闘力  騎乗  馬保有│         │    │
│ │ ├──────────────────────────┤         │    │
│ │ │ 加藤八郎    18    ✓     ✓    │         │    │
│ │ │ 小林九郎    16    ✓     ✓    │         │    │
│ │ │ 山口十郎    15    ✓     ✓    │         │    │
│ │ │ ...（省略）                  │         │    │
│ │ └──────────────────────────┘         │    │
│ │                                          │    │
│ │ 【従僕】(2人)                            │    │
│ │ ┌──────────────────────────┐         │    │
│ │ │ 名前      主人    状態        │         │    │
│ │ ├──────────────────────────┤         │    │
│ │ │ 権助      伊藤一郎  待機      │         │    │
│ │ │ 与助      伊藤一郎  待機      │         │    │
│ │ └──────────────────────────┘         │    │
│ │                                          │    │
│ └──────────────────────────────────┘    │
│                                                  │
│ ┌─ 小隊戦力サマリー ─────────────────────┐    │
│ │ 基礎戦力: 250                            │    │
│ │ 徒士加算: +165 (15人 × 平均11)           │    │
│ │ 馬上衆加算: +136 (8人 × 平均17)          │    │
│ │ 合計戦力: 551                            │    │
│ └──────────────────────────────────┘    │
│                                                  │
│ [手動入替] [戦力シミュレーション]                │
└──────────────────────────────────────────┘
```

### 小隊ビューの特徴
- **個人ユニットを兵種別にリスト表示**
- **徒士**: 名前、個人戦闘力、配置（前衛/中衛/後衛）、状態
- **馬上衆**: 名前、個人戦闘力、騎乗マーク、馬保有フラグ
- **従僕**: 名前、主人（小頭名）、状態
- **小隊戦力サマリー**: 基礎戦力 + 個人加算の内訳を表示
- **[手動入替]ボタン**: 個人ユニットの配置変更画面へ
- **[戦力シミュレーション]ボタン**: 編成変更時の戦力変化を試算

---

## 🎯 手動編成の操作フロー

### 1. ドラッグ&ドロップ
- **小隊カード**を別の中隊へドラッグして移動
- **個人ユニット**を別の小隊へドラッグして移動

### 2. 入替ボタン
- 各カードに **[↔入替]** ボタンを配置
- クリックで入替候補リストを表示
- 選択して入替実行

### 3. 自動最適化
- **[自動編成実行]** で以下を最適化：
  - 訓練度の均等化
  - 馬上衆の分散配置
  - 指揮官能力に応じた配置

---

## 📊 状態表示の詳細

### 訓練度バー
- **色**: 緑系グラデーション
- **範囲**: 0〜100
- **段階**:
  - 80〜100: 濃緑（精鋭）
  - 50〜79: 黄緑（標準）
  - 0〜49: 黄色（未熟）

### 士気バー
- **色**: 青系グラデーション
- **範囲**: 0〜100
- **段階**:
  - 40〜100: 青（良好）
  - 20〜39: 水色（軽デバフ）
  - 0〜19: 灰色（重デバフ）

### 疲労バー
- **色**: 緑→橙→赤のグラデーション
- **範囲**: 0〜100
- **段階**:
  - 0〜49: 緑（問題なし）
  - 50〜79: 橙（−10%）
  - 80〜99: 赤（−20%）
  - 100: 暗赤（−40%、戦闘不能）

---

## 🔔 アラート表示

### 警告アイコン
以下の条件で警告アイコン⚠を表示：
- **訓練度50未満**: 黄色⚠
- **士気20未満**: 赤色⚠
- **疲労80以上**: 赤色⚠

### 推奨メッセージ
画面下部に推奨アクションを表示：
```
⚠ 中隊Bの訓練度が低下しています。訓練実施を推奨します。
⚠ 小隊3の疲労が80を超えています。休息が必要です。
```

---

## 🔗 画面遷移

### 遷移元
- **役職一覧画面** → [軍事編成]ボタン
- **メイン画面** → [編成管理]メニュー

### 遷移先
- **[兵種バランス調整]** → 兵種比率調整画面
- **[手動入替]** → 個人ユニット配置画面
- **[戦力シミュレーション]** → 戦力試算画面
- **中隊カードクリック** → 中隊詳細画面（09_中隊管理画面）
- **小隊カードクリック** → 小隊詳細画面（10_小隊詳細画面）

---

## 📱 レスポンシブ対応

### デスクトップ（1920×1080）
- 大隊ビュー: 中隊3枚を横並び
- 中隊ビュー: 小隊4枚を2×2グリッド

### タブレット（1024×768）
- 大隊ビュー: 中隊3枚を縦並び
- 中隊ビュー: 小隊4枚を2×2グリッド

### モバイル（375×667）
- 大隊ビュー: 中隊1枚ずつスクロール
- 中隊ビュー: 小隊1枚ずつスクロール

---

## ✅ 実装チェックリスト

- [ ] 大隊ビューの中隊3枚表示
- [ ] 中隊ビューの小隊4枚表示
- [ ] 小隊ビューの個人ユニットリスト
- [ ] 訓練度・士気・疲労の色分けバー
- [ ] 自動編成/手動編成の切替
- [ ] ドラッグ&ドロップ操作
- [ ] 警告アイコンとメッセージ
- [ ] 兵種構成パネル
- [ ] 戦力サマリー計算表示

---

**制作日**: 2025年12月3日  
**次の画面**: `02_隊状態パネル.md`
