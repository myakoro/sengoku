# 02_隊状態パネル

**画面ID**: SCR-002  
**優先度**: 🔴 最重要  
**参照設計書**: v0.9 第3章（状態モデル）

---

## 📋 画面概要

訓練度・実戦度・疲労・士気の4つの状態を色分けバーで表示し、大隊・中隊・小隊の一覧をタブ切替で確認できる画面。  
各状態の推移グラフ（簡易版）も表示。

---

## 🎨 画面レイアウト

```
┌─────────────────────────────────────────────────────────┐
│ 【隊状態パネル】                      [戻る] [更新]      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─ 階層選択タブ ───────────────────────────────┐       │
│ │ [大隊] [中隊] [小隊]                         │       │
│ └───────────────────────────────────────────┘       │
│                                                         │
│ ┌─ 大隊一覧 ─────────────────────────────────┐       │
│ │                                               │       │
│ │ ┌─ 大隊A（足軽大将：山田太郎） ──────────┐  │       │
│ │ │                                          │  │       │
│ │ │ 訓練度: ████████░░ 75                   │  │       │
│ │ │         ┗━━━━━━━━━━━━━━━━━━━━━━━━┛  │  │       │
│ │ │         0.5 + (75/200) = 0.875 補正     │  │       │
│ │ │                                          │  │       │
│ │ │ 実戦度: ██████░░░░ 60                   │  │       │
│ │ │         ┗━━━━━━━━━━━━━━━━━━━━━━━━┛  │  │       │
│ │ │         0.6 + (60/200) = 0.900 補正     │  │       │
│ │ │                                          │  │       │
│ │ │ 疲労:   ███░░░░░░░ 25  ✓ 問題なし       │  │       │
│ │ │         ┗━━━━━━━━━━━━━━━━━━━━━━━━┛  │  │       │
│ │ │         ペナルティなし                  │  │       │
│ │ │                                          │  │       │
│ │ │ 士気:   ████████░░ 80  ✓ 良好           │  │       │
│ │ │         ┗━━━━━━━━━━━━━━━━━━━━━━━━┛  │  │       │
│ │ │         崩壊まで余裕あり                │  │       │
│ │ │                                          │  │       │
│ │ │ [詳細グラフ] [訓練実施] [休息命令]      │  │       │
│ │ └──────────────────────────────────┘  │       │
│ │                                               │       │
│ │ ┌─ 大隊B（足軽大将：佐藤次郎） ──────────┐  │       │
│ │ │                                          │  │       │
│ │ │ 訓練度: ██████░░░░ 55                   │  │       │
│ │ │ 実戦度: ████░░░░░░ 40                   │  │       │
│ │ │ 疲労:   ██████░░░░ 55  ⚠ −10%デバフ    │  │       │
│ │ │ 士気:   ███░░░░░░░ 30  ⚠ 軽デバフ      │  │       │
│ │ │                                          │  │       │
│ │ │ [詳細グラフ] [訓練実施] [休息命令]      │  │       │
│ │ └──────────────────────────────────┘  │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 状態推移グラフ（簡易版） ─────────────────┐       │
│ │                                               │       │
│ │  100 ┤                                        │       │
│ │      │   ╱‾‾╲                                │       │
│ │   75 ┤  ╱    ╲   ╱‾╲                         │       │
│ │      │ ╱      ╲ ╱   ╲                        │       │
│ │   50 ┤╱        ╲╱     ╲                       │       │
│ │      │                 ╲                      │       │
│ │   25 ┤                  ╲___                  │       │
│ │      │                                        │       │
│ │    0 └─────────────────────────────────      │       │
│ │      1日前 12h前 6h前 3h前 現在              │       │
│ │                                               │       │
│ │  ━━ 訓練度  ━━ 実戦度  ━━ 疲労  ━━ 士気    │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 🔧 UI要素詳細

### 1. ヘッダー部
- **画面タイトル**: 「隊状態パネル」（墨色・ゴシック太字）
- **[戻る]ボタン**: 前画面に戻る
- **[更新]ボタン**: 最新状態を再取得

### 2. 階層選択タブ
- **[大隊]**: 大隊単位の状態一覧（デフォルト）
- **[中隊]**: 中隊単位の状態一覧
- **[小隊]**: 小隊単位の状態一覧

### 3. 状態バー（4種類）

#### 3-1. 訓練度バー
- **色**: 緑系グラデーション
- **範囲**: 0〜100
- **補正計算式を併記**: `0.5 + (訓練度 / 200)`
- **色分け**:
  - 80〜100: `#2E7D32` 濃緑
  - 50〜79: `#7CB342` 黄緑
  - 0〜49: `#FBC02D` 黄色

#### 3-2. 実戦度バー
- **色**: 藍色系グラデーション
- **範囲**: 0〜100
- **補正計算式を併記**: `0.6 + (実戦度 / 200)`
- **色分け**:
  - 80〜100: `#1565C0` 濃藍
  - 50〜79: `#1976D2` 青
  - 0〜49: `#42A5F5` 水色

#### 3-3. 疲労バー
- **色**: 緑→橙→赤のグラデーション
- **範囲**: 0〜100
- **ペナルティ表示**:
  - 0〜49: `#66BB6A` 緑 + 「✓ 問題なし」
  - 50〜79: `#FF9800` 橙 + 「⚠ −10%デバフ」
  - 80〜99: `#E53935` 赤 + 「⚠ −20%デバフ」
  - 100: `#B71C1C` 暗赤 + 「⛔ −40%（戦闘不能）」

#### 3-4. 士気バー
- **色**: 青→灰のグラデーション
- **範囲**: 0〜100
- **状態表示**:
  - 40〜100: `#1976D2` 青 + 「✓ 良好」
  - 20〜39: `#4FC3F7` 水色 + 「⚠ 軽デバフ」
  - 1〜19: `#9E9E9E` 灰色 + 「⚠ 重デバフ」
  - 0: `#000000` 黒 + 「⛔ 即崩壊」

---

## 🔄 中隊ビュー

タブで「中隊」を選択した場合の表示：

```
┌─ 中隊一覧 ─────────────────────────────────┐
│                                               │
│ ┌─ 中隊A（組頭：佐藤次郎／性格：標準） ───┐ │
│ │                                          │ │
│ │ 訓練度: ████████░░ 78  補正: 0.890      │ │
│ │ 実戦度: ███████░░░ 65  補正: 0.925      │ │
│ │ 疲労:   ████░░░░░░ 35  ✓ 問題なし       │ │
│ │ 士気:   ████████░░ 75  ✓ 良好           │ │
│ │                                          │ │
│ │ ローテ基準: 疲労80（性格：標準）         │ │
│ │                                          │ │
│ │ [小隊内訳] [訓練実施] [休息命令]         │ │
│ └──────────────────────────────────┘ │
│                                               │
│ ┌─ 中隊B（組頭：鈴木三郎／性格：慎重） ───┐ │
│ │                                          │ │
│ │ 訓練度: ███████░░░ 70  補正: 0.850      │ │
│ │ 実戦度: ██████░░░░ 58  補正: 0.890      │ │
│ │ 疲労:   ███████░░░ 68  ⚠ 基準接近       │ │
│ │ 士気:   ███████░░░ 68  ✓ 良好           │ │
│ │                                          │ │
│ │ ローテ基準: 疲労70（性格：慎重）         │ │
│ │ ⚠ 疲労が基準に接近しています            │ │
│ │                                          │ │
│ │ [小隊内訳] [訓練実施] [休息命令]         │ │
│ └──────────────────────────────────┘ │
│                                               │
│ ┌─ 中隊C（組頭：田中四郎／性格：猪突） ───┐ │
│ │                                          │ │
│ │ 訓練度: █████░░░░░ 52  補正: 0.760      │ │
│ │ 実戦度: ████░░░░░░ 42  補正: 0.810      │ │
│ │ 疲労:   █████████░ 88  ⚠ −20%デバフ    │ │
│ │ 士気:   ████░░░░░░ 45  ✓ 良好           │ │
│ │                                          │ │
│ │ ローテ基準: 疲労90（性格：猪突）         │ │
│ │ ⚠ 疲労が高く、戦闘力が低下しています    │ │
│ │                                          │ │
│ │ [小隊内訳] [訓練実施] [休息命令]         │ │
│ └──────────────────────────────────┘ │
│                                               │
└───────────────────────────────────────┘
```

### 中隊ビューの特徴
- **性格によるローテ基準**を明記
  - 慎重: 疲労70
  - 標準: 疲労80
  - 猪突: 疲労90
- **疲労が基準に接近**した場合に警告メッセージ表示
- **[小隊内訳]ボタン**: 小隊4つの詳細状態を表示

---

## 🔄 小隊ビュー

タブで「小隊」を選択した場合の表示：

```
┌─ 小隊一覧 ─────────────────────────────────┐
│                                               │
│ ┌─ 小隊1（小頭：伊藤一郎） ──────────────┐ │
│ │                                          │ │
│ │ 訓練度: ████████░░ 82  補正: 0.910      │ │
│ │ 実戦度: ███████░░░ 70  補正: 0.950      │ │
│ │ 疲労:   ██░░░░░░░░ 18  ✓ 問題なし       │ │
│ │ 士気:   █████████░ 88  ✓ 良好           │ │
│ │                                          │ │
│ │ 有効戦闘力: 551 × 0.910 × 0.950 × 1.0   │ │
│ │           = 476 (揺らぎ前)              │ │
│ │                                          │ │
│ │ 構成: 徒士15 馬上衆8 従僕2               │ │
│ │                                          │ │
│ │ [個人詳細] [戦力内訳]                    │ │
│ └──────────────────────────────────┘ │
│                                               │
│ ┌─ 小隊2（小頭：渡辺二郎） ──────────────┐ │
│ │                                          │ │
│ │ 訓練度: ███████░░░ 68  補正: 0.840      │ │
│ │ 実戦度: ██████░░░░ 55  補正: 0.875      │ │
│ │ 疲労:   ████░░░░░░ 42  ✓ 問題なし       │ │
│ │ 士気:   ███████░░░ 72  ✓ 良好           │ │
│ │                                          │ │
│ │ 有効戦闘力: 520 × 0.840 × 0.875 × 1.0   │ │
│ │           = 382 (揺らぎ前)              │ │
│ │                                          │ │
│ │ 構成: 徒士18 馬上衆5 従僕2               │ │
│ │                                          │ │
│ │ [個人詳細] [戦力内訳]                    │ │
│ └──────────────────────────────────┘ │
│                                               │
│ ...（以下同様）                               │
│                                               │
└───────────────────────────────────────┘
```

### 小隊ビューの特徴
- **有効戦闘力の計算式**を表示
  - 基礎戦力 × 訓練補正 × 実戦補正 × 疲労補正 × 士気補正
- **構成人数**（徒士・馬上衆・従僕）を併記
- **[個人詳細]ボタン**: 個人ユニットの状態を表示
- **[戦力内訳]ボタン**: 戦力加算の詳細を表示

---

## 📊 状態推移グラフ（簡易版）

### グラフ仕様
- **横軸**: 時間（1日前 → 12h前 → 6h前 → 3h前 → 現在）
- **縦軸**: 状態値（0〜100）
- **折れ線グラフ**: 4本の線を色分け表示
  - 訓練度: 緑 `#2E7D32`
  - 実戦度: 藍 `#1565C0`
  - 疲労: 橙 `#FF9800`
  - 士気: 青 `#1976D2`

### グラフの表示タイミング
- **大隊ビュー**: 大隊全体の平均値を表示
- **中隊ビュー**: 選択中の中隊の推移を表示
- **小隊ビュー**: 選択中の小隊の推移を表示

### グラフのインタラクション
- **マウスオーバー**: 各ポイントの具体的な数値を表示
- **クリック**: 該当時点の詳細状態を別パネルで表示

---

## 🔔 アラート表示

### 警告条件
以下の条件で警告メッセージを表示：

#### 訓練度
- **50未満**: 「⚠ 訓練度が低下しています。訓練実施を推奨します。」

#### 実戦度
- **40未満**: 「⚠ 実戦度が低く、揺らぎが大きくなります。」

#### 疲労
- **50〜79**: 「⚠ 疲労が蓄積しています。−10%のデバフが発生中。」
- **80〜99**: 「⚠ 疲労が限界に近づいています。−20%のデバフが発生中。」
- **100**: 「⛔ 戦闘不能状態です。即座に休息が必要です。」

#### 士気
- **20〜39**: 「⚠ 士気が低下しています。軽デバフが発生中。」
- **1〜19**: 「⚠ 士気が危険水準です。重デバフが発生中。」
- **0**: 「⛔ 士気崩壊！即座に離脱します。」

### ローテ基準接近警告
中隊ビューで、疲労が性格別基準に接近した場合：
- **慎重**: 疲労65以上で「⚠ 疲労が基準（70）に接近しています」
- **標準**: 疲労75以上で「⚠ 疲労が基準（80）に接近しています」
- **猪突**: 疲労85以上で「⚠ 疲労が基準（90）に接近しています」

---

## 🎯 アクションボタン

### [詳細グラフ]
- 状態推移グラフを拡大表示
- 過去7日間のデータを表示
- 訓練・戦闘イベントをマーカーで表示

### [訓練実施]
- 訓練度を上昇させるコマンド
- 疲労が上昇する旨を警告
- 訓練期間（1日/3日/7日）を選択

### [休息命令]
- 疲労を回復させるコマンド
- 休息期間（1日/3日/7日）を選択
- 士気への影響を表示

### [小隊内訳]（中隊ビューのみ）
- 中隊配下の小隊4つの状態を一覧表示
- 小隊ごとの訓練度・実戦度・疲労・士気を比較

### [個人詳細]（小隊ビューのみ）
- 小隊配下の個人ユニット（徒士・馬上衆・従僕）の状態を表示
- 個人ごとの戦闘力・配置・状態を確認

### [戦力内訳]（小隊ビューのみ）
- 有効戦闘力の計算内訳を詳細表示
- 基礎戦力 + 徒士加算 + 馬上衆加算の内訳

---

## 🔗 画面遷移

### 遷移元
- **軍事編成画面** → [隊状態パネル]ボタン
- **戦場UI** → [状態確認]ボタン
- **メイン画面** → [隊状態]メニュー

### 遷移先
- **[小隊内訳]** → 小隊詳細画面（10_小隊詳細画面）
- **[個人詳細]** → 家臣詳細画面（07_家臣詳細画面）
- **[訓練実施]** → 訓練設定画面
- **[休息命令]** → 休息設定画面

---

## 📱 レスポンシブ対応

### デスクトップ（1920×1080）
- 大隊/中隊/小隊を一覧表示（3〜5件同時表示）
- 状態推移グラフを右側に固定表示

### タブレット（1024×768）
- 大隊/中隊/小隊を一覧表示（2〜3件同時表示）
- 状態推移グラフを下部に表示

### モバイル（375×667）
- 大隊/中隊/小隊を1件ずつスクロール表示
- 状態推移グラフは別タブで表示

---

## ✅ 実装チェックリスト

- [ ] 訓練度・実戦度・疲労・士気の4種バー表示
- [ ] 補正計算式の併記
- [ ] 色分けによる状態の視覚化
- [ ] 大隊・中隊・小隊のタブ切替
- [ ] 状態推移グラフ（簡易版）
- [ ] 警告メッセージとアイコン
- [ ] ローテ基準接近警告（中隊）
- [ ] 有効戦闘力の計算式表示（小隊）
- [ ] アクションボタン（訓練・休息・詳細）

---

**制作日**: 2025年12月3日  
**前の画面**: `01_軍事編成画面.md`  
**次の画面**: `03_戦場UI.md`
