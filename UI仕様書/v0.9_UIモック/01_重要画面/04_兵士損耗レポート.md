# 04_兵士損耗レポート

**画面ID**: SCR-004  
**優先度**: 🟡 重要  
**参照設計書**: v0.9 第8章（損耗処理）、第9章（人口反映ロジック）

---

## 📋 画面概要

戦闘後の兵士損耗を**死亡・廃兵・負傷・逃散**の4種類に分類して表示。  
各兵の「出身知行地ID」を表示し、自家兵 vs 借り兵を区別。  
人口への自動反映をUIで示す。

---

## 🎨 画面レイアウト

```
┌─────────────────────────────────────────────────────────┐
│ 【兵士損耗レポート】                  [戻る] [詳細CSV]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─ 損耗サマリー ─────────────────────────────┐       │
│ │                                               │       │
│ │ 総兵力: 300人 → 270人（損耗率: 10.0%）        │       │
│ │                                               │       │
│ │ ┌─────────────────────────────────┐       │       │
│ │ │ 死亡:   12人 (4.0%)  → 人口−12     │       │       │
│ │ │ 廃兵:    8人 (2.7%)  → 人口−8      │       │       │
│ │ │ 負傷:   25人 (8.3%)  → 人口影響なし│       │       │
│ │ │ 逃散:    5人 (1.7%)  → 人口−5      │       │       │
│ │ └─────────────────────────────────┘       │       │
│ │                                               │       │
│ │ 人口減少合計: 25人（死亡12 + 廃兵8 + 逃散5）  │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 損耗内訳（タブ切替） ─────────────────────┐       │
│ │ [死亡] [廃兵] [負傷] [逃散]                   │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 死亡者一覧（12人） ───────────────────────┐       │
│ │                                               │       │
│ │ ┌──────────────────────────────────┐      │       │
│ │ │ 名前    兵種  出身知行地  自/借  小隊 │      │       │
│ │ ├──────────────────────────────────┤      │       │
│ │ │ 木村五郎 徒士  村A (ID:001) 自家兵 小隊1│      │       │
│ │ │ 林六郎   徒士  村B (ID:002) 自家兵 小隊1│      │       │
│ │ │ 斎藤七郎 馬上衆 村C (ID:003) 自家兵 小隊2│      │       │
│ │ │ 加藤八郎 徒士  村D (ID:004) 借り兵 小隊3│      │       │
│ │ │ 小林九郎 徒士  村E (ID:005) 借り兵 小隊3│      │       │
│ │ │ 山口十郎 従僕  村A (ID:001) 自家兵 小隊1│      │       │
│ │ │ ...（省略）                              │      │       │
│ │ └──────────────────────────────────┘      │       │
│ │                                               │       │
│ │ 自家兵: 8人  借り兵: 4人                      │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 知行地別人口減少 ─────────────────────────┐       │
│ │                                               │       │
│ │ ┌──────────────────────────────────┐      │       │
│ │ │ 知行地   死亡 廃兵 逃散 合計 人口減少 │      │       │
│ │ ├──────────────────────────────────┤      │       │
│ │ │ 村A (001)  3    2    1    6   → −6   │      │       │
│ │ │ 村B (002)  2    1    0    3   → −3   │      │       │
│ │ │ 村C (003)  1    1    1    3   → −3   │      │       │
│ │ │ 村D (004)  2    1    1    4   → −4   │      │       │
│ │ │ 村E (005)  1    1    0    2   → −2   │      │       │
│ │ │ 他村借兵   3    2    2    7   → −7   │      │       │
│ │ └──────────────────────────────────┘      │       │
│ │                                               │       │
│ │ ⚠ 村Aの人口が6人減少しました                 │       │
│ │ ⚠ 他村借兵の損耗が7人発生しました            │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 自動処理の確認 ───────────────────────────┐       │
│ │                                               │       │
│ │ ✓ 死亡・廃兵・逃散の人口減少を自動反映       │       │
│ │ ✓ 負傷兵は治療後に復帰（人口影響なし）       │       │
│ │ ✓ 借り兵の損耗は戦功ペナルティに反映済み     │       │
│ │                                               │       │
│ │ [人口データを確認] [戦功レポートへ]           │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 🔧 UI要素詳細

### 1. ヘッダー部
- **画面タイトル**: 「兵士損耗レポート」（墨色・ゴシック太字）
- **[戻る]ボタン**: 前画面（戦闘結果サマリー）に戻る
- **[詳細CSV]ボタン**: 損耗データをCSV形式でエクスポート

---

### 2. 損耗サマリー

#### 2-1. 総兵力の変化
- **戦闘前**: 300人
- **戦闘後**: 270人
- **損耗率**: 10.0%（30人 / 300人）

#### 2-2. 損耗内訳（4種類）
| 種類 | 人数 | 割合 | 人口への影響 |
|------|------|------|-------------|
| **死亡** | 12人 | 4.0% | 人口−12 |
| **廃兵** | 8人 | 2.7% | 人口−8 |
| **負傷** | 25人 | 8.3% | 人口影響なし |
| **逃散** | 5人 | 1.7% | 人口−5 |

#### 2-3. 人口減少合計
- **合計**: 25人（死亡12 + 廃兵8 + 逃散5）
- **負傷は除外**: 負傷兵は治療後に復帰するため人口には影響しない

---

### 3. 損耗内訳（タブ切替）

#### 3-1. タブ構成
- **[死亡]**: 死亡者一覧（デフォルト表示）
- **[廃兵]**: 廃兵一覧
- **[負傷]**: 負傷者一覧
- **[逃散]**: 逃散者一覧

#### 3-2. 各タブの表示内容
各タブには以下の情報を表形式で表示：
- **名前**: 兵士の名前
- **兵種**: 徒士/馬上衆/従僕
- **出身知行地**: 知行地名 + ID（例: 村A (ID:001)）
- **自/借**: 自家兵 or 借り兵
- **小隊**: 所属小隊名

---

### 4. 死亡者一覧（例）

```
┌──────────────────────────────────┐
│ 名前    兵種  出身知行地  自/借  小隊 │
├──────────────────────────────────┤
│ 木村五郎 徒士  村A (ID:001) 自家兵 小隊1│
│ 林六郎   徒士  村B (ID:002) 自家兵 小隊1│
│ 斎藤七郎 馬上衆 村C (ID:003) 自家兵 小隊2│
│ 加藤八郎 徒士  村D (ID:004) 借り兵 小隊3│
│ 小林九郎 徒士  村E (ID:005) 借り兵 小隊3│
│ 山口十郎 従僕  村A (ID:001) 自家兵 小隊1│
│ ...（省略）                              │
└──────────────────────────────────┘

自家兵: 8人  借り兵: 4人
```

### 自家兵 vs 借り兵の区別
- **自家兵**: 青色 `#1976D2` で表示
- **借り兵**: 橙色 `#FF9800` で表示 + ⚠アイコン

---

### 5. 知行地別人口減少

#### 5-1. 表形式
| 知行地 | 死亡 | 廃兵 | 逃散 | 合計 | 人口減少 |
|--------|------|------|------|------|----------|
| 村A (001) | 3 | 2 | 1 | 6 | → −6 |
| 村B (002) | 2 | 1 | 0 | 3 | → −3 |
| 村C (003) | 1 | 1 | 1 | 3 | → −3 |
| 村D (004) | 2 | 1 | 1 | 4 | → −4 |
| 村E (005) | 1 | 1 | 0 | 2 | → −2 |
| 他村借兵 | 3 | 2 | 2 | 7 | → −7 |

#### 5-2. 警告メッセージ
- **自村の人口減少**: 「⚠ 村Aの人口が6人減少しました」
- **借り兵の損耗**: 「⚠ 他村借兵の損耗が7人発生しました」

#### 5-3. 色分け
- **人口減少が多い知行地**: 赤色 `#E53935` でハイライト
  - 減少率5%以上: 赤色
  - 減少率3〜5%: 橙色 `#FF9800`
  - 減少率3%未満: 黄色 `#FBC02D`

---

### 6. 自動処理の確認

#### 6-1. 自動処理の内容
- **✓ 死亡・廃兵・逃散の人口減少を自動反映**
  - 各兵の出身知行地IDに紐づけて人口−1
- **✓ 負傷兵は治療後に復帰（人口影響なし）**
  - 負傷兵は一定期間後に復帰
- **✓ 借り兵の損耗は戦功ペナルティに反映済み**
  - 借り兵の死亡・廃兵・逃散は戦功−1〜−5

#### 6-2. アクションボタン
- **[人口データを確認]**: 知行地の人口データ画面へ遷移
- **[戦功レポートへ]**: 家臣戦功レポート（05_家臣戦功レポート）へ遷移

---

## 📊 損耗の詳細説明

### 死亡
- **定義**: 戦闘中に死亡した兵士
- **人口への影響**: 出身知行地の人口−1
- **小隊への影響**:
  - 徒士: 小隊戦力減少、士気−2〜4
  - 馬上衆: 小隊戦力減少、士気−2〜5
  - 従僕: 小隊に影響なし、小頭の一時的精度低下

### 廃兵
- **定義**: 重傷により戦闘不能になった兵士
- **人口への影響**: 出身知行地の人口−1
- **小隊への影響**: 死亡と同様

### 負傷
- **定義**: 軽傷で治療後に復帰可能な兵士
- **人口への影響**: なし（治療後に復帰）
- **小隊への影響**: 一時的に戦力減少、治療期間後に復帰

### 逃散
- **定義**: 戦闘から逃亡した兵士
- **人口への影響**: 出身知行地の人口−1
- **小隊への影響**: 戦力減少、士気−1〜2

---

## 🔔 アラート表示

### 高損耗警告
以下の条件で警告アラートを表示：

#### 総損耗率
- **10%以上**: 「⚠ 総損耗率が10%を超えています。」
- **20%以上**: 「⛔ 総損耗率が20%を超えています！兵力の補充が必要です。」

#### 知行地の人口減少
- **減少率5%以上**: 「⚠ 村Aの人口減少率が5%を超えています。」
- **減少率10%以上**: 「⛔ 村Bの人口減少率が10%を超えています！村の維持が困難です。」

#### 借り兵の損耗
- **借り兵損耗5人以上**: 「⚠ 借り兵の損耗が5人を超えています。戦功ペナルティが発生します。」
- **借り兵損耗10人以上**: 「⛔ 借り兵の損耗が10人を超えています！大幅な戦功ペナルティが発生します。」

---

## 🔗 画面遷移

### 遷移元
- **戦闘結果サマリー** → [損耗詳細]ボタン
- **戦場UI** → [損耗確認]ボタン

### 遷移先
- **[人口データを確認]** → 知行地管理画面
- **[戦功レポートへ]** → 家臣戦功レポート（05_家臣戦功レポート）
- **[戻る]** → 戦闘結果サマリー（12_戦闘結果サマリー）

---

## 📱 レスポンシブ対応

### デスクトップ（1920×1080）
- 損耗サマリー、損耗内訳、知行地別人口減少を同時表示
- 横並びレイアウト

### タブレット（1024×768）
- 損耗サマリーを上部に表示
- 損耗内訳と知行地別人口減少を縦並び

### モバイル（375×667）
- タブ切替で表示
  - [サマリー] [内訳] [知行地別]

---

## ✅ 実装チェックリスト

- [ ] 損耗サマリー（死亡・廃兵・負傷・逃散）
- [ ] 損耗内訳のタブ切替
- [ ] 死亡者一覧（名前・兵種・出身知行地・自/借・小隊）
- [ ] 自家兵 vs 借り兵の色分け
- [ ] 知行地別人口減少の表示
- [ ] 人口減少の警告メッセージ
- [ ] 自動処理の確認パネル
- [ ] [人口データを確認]ボタン
- [ ] [戦功レポートへ]ボタン
- [ ] [詳細CSV]エクスポート機能

---

**制作日**: 2025年12月3日  
**前の画面**: `03_戦場UI.md`  
**次の画面**: `05_家臣戦功レポート.md`
