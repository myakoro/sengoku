# 03_戦場UI（v0.9簡易版）

**画面ID**: SCR-003  
**優先度**: 🔴 最重要  
**参照設計書**: v0.9 第4章（押し合い）、第6章（中隊AI）、第7章（大隊AI）

---

## 📋 画面概要

v0.9の戦場UIは**簡易版**。  
押し合い表示、前線/後衛の配置、中隊ローテーション、崩壊アラート、追撃判定の演出、結果ログパネルを表示。

**※ 詳細戦場UI（個人視点・地形）は v1.1以降のため本バージョンでは不要。**

---

## 🎨 画面レイアウト

```
┌─────────────────────────────────────────────────────────┐
│ 【戦場】                              [一時停止] [終了]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─ ミニマップ（簡易版） ─────────────────────┐       │
│ │                                               │       │
│ │        【敵軍】                               │       │
│ │   ┌───────────────────┐                   │       │
│ │   │ 大隊A  大隊B  大隊C │ ← 敵前線         │       │
│ │   └───────────────────┘                   │       │
│ │                                               │       │
│ │   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │       │
│ │              ⚔ 押し合い中 ⚔                 │       │
│ │   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │       │
│ │                                               │       │
│ │   ┌───────────────────┐                   │       │
│ │   │ 中隊A  中隊B  中隊C │ ← 自軍前線       │       │
│ │   └───────────────────┘                   │       │
│ │   ┌───────────────────┐                   │       │
│ │   │ 中隊D  中隊E       │ ← 自軍後衛       │       │
│ │   └───────────────────┘                   │       │
│ │                                               │       │
│ │        【自軍】                               │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 押し合い状況 ─────────────────────────────┐       │
│ │                                               │       │
│ │ サイクル: 第12回                              │       │
│ │                                               │       │
│ │ ┌─ 自軍 vs 敵軍 ──────────────────┐        │       │
│ │ │                                    │        │       │
│ │ │ 自軍戦力: 1,250                    │        │       │
│ │ │ 敵軍戦力: 1,180                    │        │       │
│ │ │                                    │        │       │
│ │ │ 戦力差: +70 (自軍優勢)             │        │       │
│ │ │                                    │        │       │
│ │ │ ████████████████░░░░ 自軍          │        │       │
│ │ │ ██████████████░░░░░░ 敵軍          │        │       │
│ │ │                                    │        │       │
│ │ │ 判定: 【自軍勝ち】                 │        │       │
│ │ │                                    │        │       │
│ │ └────────────────────────────┘        │       │
│ │                                               │       │
│ │ ┌─ 士気・疲労の変動 ──────────────┐        │       │
│ │ │                                    │        │       │
│ │ │ 自軍中隊A: 士気 80→82 (+2)         │        │       │
│ │ │           疲労 25→28 (+3)         │        │       │
│ │ │                                    │        │       │
│ │ │ 敵軍大隊A: 士気 65→60 (−5)         │        │       │
│ │ │           疲労 40→45 (+5)         │        │       │
│ │ │                                    │        │       │
│ │ └────────────────────────────┘        │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 中隊ローテーション ───────────────────────┐       │
│ │                                               │       │
│ │ ⚠ 中隊Bの疲労が80に達しました                │       │
│ │ → 中隊Dと交代します                          │       │
│ │                                               │       │
│ │ [前線] 中隊A  中隊D  中隊C                    │       │
│ │ [後衛] 中隊E  中隊B（休息中）                 │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 崩壊アラート ─────────────────────────────┐       │
│ │                                               │       │
│ │ ⛔ 敵軍大隊Cの士気が0になりました！           │       │
│ │ → 崩壊・離脱します                           │       │
│ │                                               │       │
│ │ [追撃判定中...]                               │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
│ ┌─ 結果ログ ─────────────────────────────────┐       │
│ │                                               │       │
│ │ 12:34 自軍中隊A vs 敵軍大隊A → 自軍勝ち      │       │
│ │ 12:35 敵軍士気−5、疲労+5                     │       │
│ │ 12:36 中隊Bの疲労が80に達し、ローテ実施      │       │
│ │ 12:37 敵軍大隊Cが崩壊！追撃判定開始          │       │
│ │ 12:38 追撃強度P2で追撃実施                   │       │
│ │ 12:39 敵軍損耗: 死亡12 廃兵8 負傷25 逃散5    │       │
│ │                                               │       │
│ └───────────────────────────────────────┘       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 🔧 UI要素詳細

### 1. ヘッダー部
- **画面タイトル**: 「戦場」（墨色・ゴシック太字）
- **[一時停止]ボタン**: 戦闘を一時停止
- **[終了]ボタン**: 戦闘を強制終了（確認ダイアログ表示）

### 2. ミニマップ（簡易版）

#### 2-1. 敵軍エリア
- **大隊表示**: 矩形ブロックで表示
  - 色: 赤系 `#E53935`
  - サイズ: 兵力に応じて可変
  - ラベル: 「大隊A」「大隊B」など

#### 2-2. 押し合いライン
- **境界線**: 太い二重線で表示
- **アイコン**: ⚔（剣のアイコン）+ 「押し合い中」

#### 2-3. 自軍エリア
- **前線中隊**: 矩形ブロックで表示
  - 色: 青系 `#1976D2`
  - サイズ: 兵力に応じて可変
  - ラベル: 「中隊A」「中隊B」など
- **後衛中隊**: 矩形ブロックで表示
  - 色: 灰青系 `#546E7A`
  - ラベル: 「中隊D（後衛）」など

#### 2-4. ミニマップの更新
- **リアルタイム更新**: 押し合いサイクルごとに更新
- **ローテ時のアニメーション**: 前線⇔後衛の入替を矢印で表示
- **崩壊時のエフェクト**: 崩壊した大隊/中隊が点滅→消失

---

### 3. 押し合い状況パネル

#### 3-1. サイクル表示
- **サイクル番号**: 「第12回」など
- **経過時間**: 「戦闘開始から36分」など

#### 3-2. 戦力比較
- **自軍戦力**: 有効戦闘力の合計
- **敵軍戦力**: 有効戦闘力の合計
- **戦力差**: 差分と優劣を表示
  - 自軍優勢: 緑色 `#66BB6A`
  - 拮抗: 黄色 `#FBC02D`
  - 敵軍優勢: 赤色 `#E53935`

#### 3-3. 戦力バー
- **自軍バー**: 青色 `#1976D2`
- **敵軍バー**: 赤色 `#E53935`
- **長さ**: 戦力に比例

#### 3-4. 判定結果
- **自軍勝ち**: 緑背景 + 「【自軍勝ち】」
- **拮抗**: 黄背景 + 「【拮抗】」
- **敵軍勝ち**: 赤背景 + 「【敵軍勝ち】」

---

### 4. 士気・疲労の変動パネル

#### 4-1. 自軍の変動
- **中隊ごとに表示**:
  - 中隊名
  - 士気の変動（例: 80→82 (+2)）
  - 疲労の変動（例: 25→28 (+3)）
- **色分け**:
  - 上昇: 緑色 `#66BB6A`
  - 下降: 赤色 `#E53935`

#### 4-2. 敵軍の変動
- **大隊ごとに表示**:
  - 大隊名
  - 士気の変動（例: 65→60 (−5)）
  - 疲労の変動（例: 40→45 (+5)）

---

### 5. 中隊ローテーションパネル

#### 5-1. ローテ発動条件の表示
- **疲労基準到達**: 「⚠ 中隊Bの疲労が80に達しました」
- **士気低下**: 「⚠ 中隊Aの士気が30未満になりました」
- **連続押し負け**: 「⚠ 中隊Cが3回連続で押し負けています」

#### 5-2. ローテ実行の表示
- **交代前**: `[前線] 中隊A 中隊B 中隊C`
- **交代後**: `[前線] 中隊A 中隊D 中隊C`
- **アニメーション**: 中隊BとDが入れ替わる矢印表示

#### 5-3. 後衛の状態
- **休息中**: 「中隊B（休息中）」
- **疲労回復**: 「疲労 80→65 (−15)」

---

### 6. 崩壊アラートパネル

#### 6-1. 崩壊発生時
- **アラート表示**: 「⛔ 敵軍大隊Cの士気が0になりました！」
- **背景色**: 赤色 `#FFCDD2`
- **効果音**: 警告音（ビープ音）

#### 6-2. 崩壊後の処理
- **離脱表示**: 「→ 崩壊・離脱します」
- **追撃判定開始**: 「[追撃判定中...]」
- **追撃強度表示**: 「追撃強度P2で追撃実施」

#### 6-3. 追撃演出
- **追撃アイコン**: 🏹（弓矢）または 🗡（刀）
- **損耗カウントアップ**: 「敵軍損耗: 死亡12 廃兵8 負傷25 逃散5」
- **アニメーション**: 敵軍ブロックが縮小

---

### 7. 結果ログパネル

#### 7-1. ログの表示形式
- **タイムスタンプ**: 「12:34」
- **イベント内容**: 「自軍中隊A vs 敵軍大隊A → 自軍勝ち」
- **色分け**:
  - 自軍勝ち: 緑色 `#66BB6A`
  - 拮抗: 黄色 `#FBC02D`
  - 敵軍勝ち: 赤色 `#E53935`

#### 7-2. ログの種類
- **押し合い結果**: 「自軍中隊A vs 敵軍大隊A → 自軍勝ち」
- **士気・疲労変動**: 「敵軍士気−5、疲労+5」
- **ローテ実施**: 「中隊Bの疲労が80に達し、ローテ実施」
- **崩壊発生**: 「敵軍大隊Cが崩壊！追撃判定開始」
- **追撃実施**: 「追撃強度P2で追撃実施」
- **損耗発生**: 「敵軍損耗: 死亡12 廃兵8 負傷25 逃散5」

#### 7-3. ログの自動スクロール
- **最新ログを常に表示**: 新しいログが追加されると自動スクロール
- **過去ログの確認**: スクロールバーで過去のログを確認可能

---

## 🎯 追撃判定の演出

### 追撃条件チェック
以下の条件をすべて満たす場合に追撃を実施：
- 自軍疲労 < 60
- 自軍士気 ≥ 50
- 敵が完全崩壊（士気0）
- 地形が追撃可能

### 追撃強度の表示
追撃強度（P1〜P3）を以下のように表示：

#### P1（弱追撃）
- **アイコン**: 🏹（弓矢）
- **色**: 黄色 `#FBC02D`
- **メッセージ**: 「追撃強度P1で追撃実施（弱）」
- **損耗予測**: 「敵軍損耗: 5〜10%」

#### P2（中追撃）
- **アイコン**: 🗡（刀）
- **色**: 橙色 `#FF9800`
- **メッセージ**: 「追撃強度P2で追撃実施（中）」
- **損耗予測**: 「敵軍損耗: 10〜20%」

#### P3（強追撃）
- **アイコン**: ⚔（剣）
- **色**: 赤色 `#E53935`
- **メッセージ**: 「追撃強度P3で追撃実施（強）」
- **損耗予測**: 「敵軍損耗: 20〜30%」

### 追撃結果の表示
追撃後の損耗内訳を表示：
```
敵軍損耗:
  死亡: 12人
  廃兵: 8人
  負傷: 25人
  逃散: 5人
  合計: 50人（損耗率: 16.7%）
```

---

## 🔔 アラート表示

### 自軍の危機
以下の条件で警告アラートを表示：

#### 疲労警告
- **疲労80以上**: 「⚠ 中隊Aの疲労が80を超えています。ローテを推奨します。」

#### 士気警告
- **士気30未満**: 「⚠ 中隊Bの士気が30未満です。段階的後退を検討してください。」
- **士気20未満**: 「⛔ 中隊Cの士気が20未満です！崩壊の危険があります。」

#### 戦力劣勢
- **戦力差−100以上**: 「⚠ 敵軍が優勢です。後退を検討してください。」
- **戦力差−200以上**: 「⛔ 敵軍が大幅に優勢です！総退却を推奨します。」

### 敵軍の状況
以下の条件で情報アラートを表示：

#### 敵軍崩壊
- **敵大隊崩壊**: 「✓ 敵軍大隊Aが崩壊しました。追撃可能です。」

#### 敵軍後退
- **敵軍段階的後退**: 「✓ 敵軍が後退を開始しました。」
- **敵軍総退却**: 「✓ 敵軍が総退却しました。戦闘終了です。」

---

## 🎮 操作インターフェース

### [一時停止]ボタン
- **機能**: 戦闘を一時停止
- **一時停止中の操作**:
  - 状態確認
  - ログの詳細確認
  - 戦力シミュレーション
  - 再開ボタンで戦闘再開

### [終了]ボタン
- **機能**: 戦闘を強制終了
- **確認ダイアログ**: 「戦闘を終了しますか？（敗北扱いになります）」
- **選択肢**: [はい] [いいえ]

### [詳細表示]ボタン
- **機能**: 各中隊/大隊の詳細状態を表示
- **表示内容**:
  - 訓練度・実戦度・疲労・士気
  - 有効戦闘力の内訳
  - 個人ユニットの状態

### [戦力シミュレーション]ボタン
- **機能**: 現在の戦力で今後の展開を予測
- **表示内容**:
  - 勝率予測
  - 損耗予測
  - 推奨行動（攻勢/守勢/後退）

---

## 🔗 画面遷移

### 遷移元
- **軍事編成画面** → [戦闘開始]ボタン
- **大隊管理画面** → [出陣]ボタン

### 遷移先
- **[詳細表示]** → 隊状態パネル（02_隊状態パネル）
- **[戦闘終了]** → 戦闘結果サマリー（12_戦闘結果サマリー）
- **[損耗確認]** → 兵士損耗レポート（04_兵士損耗レポート）
- **[戦功確認]** → 家臣戦功レポート（05_家臣戦功レポート）

---

## 📱 レスポンシブ対応

### デスクトップ（1920×1080）
- ミニマップ、押し合い状況、ローテ、崩壊アラート、ログを同時表示
- 横並びレイアウト

### タブレット（1024×768）
- ミニマップと押し合い状況を上部に表示
- ローテ、崩壊アラート、ログを下部に縦並び

### モバイル（375×667）
- タブ切替で表示
  - [ミニマップ] [状況] [ログ]

---

## ✅ 実装チェックリスト

- [ ] ミニマップ（簡易版）の表示
- [ ] 押し合い状況パネル（戦力比較・判定）
- [ ] 士気・疲労の変動表示
- [ ] 中隊ローテーションパネル
- [ ] 崩壊アラートパネル
- [ ] 追撃判定の演出（P1〜P3）
- [ ] 結果ログパネル（自動スクロール）
- [ ] 警告アラート（疲労・士気・戦力劣勢）
- [ ] 一時停止・終了ボタン
- [ ] 詳細表示・戦力シミュレーションボタン

---

## 📝 v1.1以降で追加予定の要素（本バージョンでは不要）

- 個人視点の戦場UI
- 地形効果の詳細表示
- 陣形・包囲の可視化
- 伏兵の演出
- 総大将の戦略AI表示

---

**制作日**: 2025年12月3日  
**前の画面**: `02_隊状態パネル.md`  
**次の画面**: `04_兵士損耗レポート.md`
