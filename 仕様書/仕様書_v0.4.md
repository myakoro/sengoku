# 戦国立身出世SLG v0.4 仕様書

**バージョン**: 0.4  
**目的**: 日常ターン制SLGの基礎確立  
**作成日**: 2025-11-29

---

## 1. 概要

### 1.1 v0.4の目的

v0.4は「日常ターン制の確立」を目標とする。v0.3で実装した最小限の日次・月次フローに対し、以下を追加する：

* **行動フェイズの拡充**：公務・私事の具体的なタスクを実装
* **功績システムの導入**：軍事功・政務功・密功の3系統
* **評価システムの基礎**：上司からの評価と月次更新
* **貸しシステムの簡易版**：公務成功時の貸し蓄積
* **月次処理の拡張**：功績集計、評価更新、収支報告

### 1.2 v0.3からの追加要素

* 公務タスク6種（治安維持、巡察、検地補助、普請補助、書状作成、情報収集）
* 私事タスク4種（知行村開発、道整備、村商人取引、名産開発準備）
* 功績の3系統管理（軍事功、政務功、密功）
* 評価の月次更新ロジック
* 貸しの簡易蓄積（上司への貸し）
* 月次サマリーの拡張（功績・評価・貸しの表示）

### 1.3 非スコープ（v0.4では実装しない）

以下は1.0以降の拡張とし、v0.4では実装しない：

* 戦闘・軍事AI
* 家臣団の詳細（採用・忠誠・補佐官・戦死）
* 出世イベント（任官・辞令）
* 婚姻・世代交代
* 引き抜き・調略本体
* 評定システム（会議）
* 主命システム（特命）
* 旬イベント
* 年次イベント
* 自然増減（人口・治安の自動変動）
* ランダムイベント

---

## 2. 用語定義

### 2.1 時間単位（別紙M準拠）

* **日**：ゲームの基本ターン。1日に1行動（公務 or 私事）を実行。
* **旬**：10日単位。v0.4では未使用（将来拡張用）。
* **月**：30日単位。月末に月次処理が発生。
* **季節**：v0.4では未使用（将来拡張用）。

### 2.2 行動分類（別紙D準拠）

* **公務**：主君・上司から命じられる仕事。功績が発生し、出世に直結。金・資源は得られない。
* **私事**：自家の利益のための活動。金・資源が得られるが、功績は一切発生しない。

### 2.3 功績（別紙I準拠）

出世判定に使用される実績値。以下の3系統が存在：

* **軍事功**：治安維持、巡察など軍事系公務で獲得
* **政務功**：検地補助、普請補助など政務系公務で獲得
* **密功**：情報収集、書状作成など調略系公務で獲得

### 2.4 評価（別紙J準拠）

上司（主君）がプレイヤーの家に対して持つ信用度。公務の成功・失敗、功績の量、部下の質などから形成される。月次で更新される。

### 2.5 貸し（別紙J準拠・簡易版）

家同士の信用バランス。v0.4では「上司への貸し」のみ実装。一定条件以上の公務成功時に+1される。評価更新や推薦に影響する。

---

## 3. 時間進行の仕様

### 3.1 内部カレンダー構造

* **年**: 整数（例：1587）
* **月**: 1〜12
* **日**: 1〜30（全月30日固定）

### 3.2 日付+1処理

行動実行後、以下の処理を行う：

1. 日付を+1する
2. 日付が31になった場合、月を+1し、日を1にリセット
3. 月が13になった場合、年を+1し、月を1にリセット

### 3.3 月の境界判定

日付更新後、日が1かつ月が変わった場合、月次処理トリガーをONにする。

### 3.4 月次処理のトリガー

月次処理は以下のタイミングで発生：

* 日付更新後、月の境界判定がtrueの場合
* 月次処理完了後、日常画面に戻る前に月次サマリー画面を表示

---

## 4. 行動フェイズ仕様

### 4.1 メイン画面からの遷移フロー

```
メイン画面
  ↓
[公務]ボタン or [私事]ボタン押下
  ↓
行動選択画面（公務タスク一覧 or 私事タスク一覧）
  ↓
タスク選択
  ↓
実行処理（データ更新）
  ↓
結果表示（ログ追加）
  ↓
日付+1
  ↓
月次判定
  ├─ 月末でない → メイン画面へ戻る
  └─ 月末 → 月次処理 → 月次サマリー画面 → メイン画面へ戻る
```

### 4.2 公務ボタン押下後の処理

1. 公務タスク一覧を表示（6種）
2. プレイヤーが1つ選択
3. 選択したタスクの処理を実行
4. 公務フラグをONに設定
5. 結果をログに追加
6. 日付+1処理へ

### 4.3 私事ボタン押下後の処理

1. 私事タスク一覧を表示（4種）
2. プレイヤーが1つ選択
3. 選択したタスクの処理を実行
4. 結果をログに追加
5. 日付+1処理へ

### 4.4 行動後の処理フロー

1. データ反映（功績、評価、金、資源、村パラメータ）
2. ログ記録（DailyLog）
3. 日付進行
4. 月次チェック
5. 画面遷移

---

## 5. 公務タスクの仕様（最小セット）

v0.4では以下の6種を実装する。すべて**行動は必ず成功**し、失敗判定は行わない。

### 5.1 治安維持

**系統**: 軍事功  
**対象**: 村（村A or 村B）  
**入力条件**: なし  
**成功判定**: 常に成功  
**変動内容**:

* 村.security: +3
* 功績.軍事功: +1
* 評価: 変動なし（月次で反映）
* 貸し: 変動なし
* 金・資源: 変動なし

**公務フラグ**: ON

### 5.2 巡察

**系統**: 軍事功  
**対象**: 村（村A or 村B）  
**入力条件**: なし  
**成功判定**: 常に成功  
**変動内容**:

* 村.security: +1
* 功績.軍事功: +1
* 評価: 変動なし（月次で反映）
* 貸し: 変動なし
* 金・資源: 変動なし

**公務フラグ**: ON

### 5.3 検地補助

**系統**: 政務功  
**対象**: 村（村A or 村B）  
**入力条件**: なし  
**成功判定**: 常に成功  
**変動内容**:

* 村パラメータ: 変動なし
* 功績.政務功: +2
* 評価: 変動なし（月次で反映）
* 貸し: +1（上司への貸し）
* 金・資源: 変動なし

**公務フラグ**: ON

### 5.4 普請補助

**系統**: 政務功  
**対象**: 村（村A or 村B）  
**入力条件**: なし  
**成功判定**: 常に成功  
**変動内容**:

* 村.development: +1
* 功績.政務功: +1
* 評価: 変動なし（月次で反映）
* 貸し: 変動なし
* 金・資源: 変動なし

**公務フラグ**: ON

### 5.5 書状作成

**系統**: 密功  
**対象**: なし  
**入力条件**: なし  
**成功判定**: 常に成功  
**変動内容**:

* 村パラメータ: 変動なし
* 功績.密功: +1
* 評価: 変動なし（月次で反映）
* 貸し: 変動なし
* 金・資源: 変動なし

**公務フラグ**: ON

### 5.6 情報収集

**系統**: 密功  
**対象**: なし  
**入力条件**: なし  
**成功判定**: 常に成功  
**変動内容**:

* 村パラメータ: 変動なし
* 功績.密功: +2
* 評価: 変動なし（月次で反映）
* 貸し: +1（上司への貸し）
* 金・資源: 変動なし

**公務フラグ**: ON

### 5.7 公務共通仕様

* すべての公務で**金・資源は増えない**（別紙Dの絶対条件）
* 成功判定は行わず、常に成功扱い
* 功績は即時加算
* 評価は月次で更新
* 貸しは条件を満たした場合のみ加算

---

## 6. 私事タスクの仕様（最小セット）

v0.4では以下の4種を実装する。すべて**行動は必ず成功**し、失敗判定は行わない。

### 6.1 知行村の開発

**対象**: 村（村A or 村B）  
**入力条件**: なし  
**成果**:

* 村.development: +2
* 村.population: +5
* player.money: -10

**功績**: 一切発生しない（別紙Dの絶対条件）

### 6.2 道整備

**対象**: 村（村A or 村B）  
**入力条件**: なし  
**成果**:

* 村.development: +1
* player.money: -5

**功績**: 一切発生しない

### 6.3 村商人との取引

**対象**: 村商人（村A or 村B）  
**入力条件**: なし  
**成果**:

* player.money: +10

**功績**: 一切発生しない

**備考**: 街商人以降はv0.4では実装しない（別紙H参照）

### 6.4 名産開発の準備

**対象**: 村（村A or 村B）  
**入力条件**: なし  
**成果**:

* 村.development: +1
* player.money: -15
* 名産開発フラグ: ON（将来拡張用）

**功績**: 一切発生しない

### 6.5 私事共通仕様

* すべての私事で**功績は一切発生しない**（別紙Dの絶対条件）
* 成功判定は行わず、常に成功扱い
* 金・資源・村パラメータが変動
* 公務フラグは変更しない

---

## 7. 評価・功績・貸しの更新仕様

### 7.1 功績の更新

* **更新タイミング**: 公務実行時に即時加算
* **対象**: 軍事功、政務功、密功の3系統
* **加算量**: 各タスクの仕様に従う
* **表示**: プレイヤーステータスに常時表示

### 7.2 評価の更新

* **更新タイミング**: 月次処理時のみ
* **計算方法**（簡易版）:
  * 公務フラグがONの場合: 評価 +1
  * 功績合計が一定以上の場合: 評価 +1（追加）
  * 貸しが一定以上の場合: 評価 +1（追加）
* **表示**: プレイヤーステータスに常時表示

### 7.3 貸しの更新（簡易版）

* **更新タイミング**: 公務実行時（条件を満たした場合のみ）
* **条件**: 検地補助、情報収集など特定タスクの成功時
* **加算量**: +1
* **表示**: プレイヤーステータスに常時表示
* **備考**: v0.4では「上司への貸し」のみ実装。商人・寺社への貸しは将来拡張。

---

## 8. 月次サマリー仕様

### 8.1 集計対象

月次サマリーでは以下を集計・表示する：

* **公務回数**: 当月中に公務を実行した日数
* **公務成功率**: v0.4では常に100%（失敗判定なし）
* **私事の成果**: 村の開発度変化、人口変化
* **功績増分**: 軍事功、政務功、密功の当月増加量
* **評価変化**: 前月比の評価増減
* **金・資源の収支**: 収入（村A+村B）、支出（私事）、差分

### 8.2 画面へ渡すデータ構造（DTO）

```
MonthlySummaryData {
  year: 整数
  month: 整数
  publicDutyCount: 整数
  publicDutySuccessRate: 整数（%）
  achievementMilitary: 整数（当月増分）
  achievementPolitical: 整数（当月増分）
  achievementSecret: 整数（当月増分）
  evaluationChange: 整数（前月比）
  incomeTotal: 整数（村A.income + 村B.income）
  expenseTotal: 整数（私事での支出合計）
  moneyBalance: 整数（収入 - 支出）
  villageADevelopmentChange: 整数
  villageBDevelopmentChange: 整数
  villageAPopulationChange: 整数
  villageBPopulationChange: 整数
}
```

### 8.3 月次処理フロー

1. 収入処理: 村A.income + 村B.income → player.money
2. 評価処理: 公務フラグ、功績、貸しから評価を更新
3. 公務フラグリセット: false
4. 月次サマリーデータ生成
5. 月次サマリー画面表示
6. ユーザーが「次月へ」ボタン押下
7. メイン画面へ戻る

---

## 9. データモデル（v0.4に必須の最小セット）

### 9.1 Player

| フィールド名 | 型 | 説明 | 初期値 |
|---|---|---|---|
| name | 文字列 | プレイヤー名 | "田中太郎" |
| affiliation | 文字列 | 所属家 | "織田家（羽柴家）" |
| rank | 文字列 | 家格 | "書役" |
| role | 文字列 | 役割 | "書役" |
| money | 整数 | 所持金（負数許容） | 100 |
| evaluation | 整数 | 上司からの評価 | 0 |
| favor | 整数 | 上司への貸し | 0 |
| achievementMilitary | 整数 | 軍事功 | 0 |
| achievementPolitical | 整数 | 政務功 | 0 |
| achievementSecret | 整数 | 密功 | 0 |

### 9.2 Village

| フィールド名 | 型 | 説明 | 初期値（村A/村B） |
|---|---|---|---|
| name | 文字列 | 村名 | "村A" / "村B" |
| population | 整数 | 人口 | 1000 / 500 |
| security | 整数 | 治安 | 50 / 30 |
| income | 整数 | 収入（固定） | 100 / 50 |
| development | 整数 | 開発度 | 10 / 5 |

### 9.3 Lord

| フィールド名 | 型 | 説明 | 初期値 |
|---|---|---|---|
| name | 文字列 | 主君名 | "羽柴秀吉" |

### 9.4 DailyLog

| フィールド名 | 型 | 説明 |
|---|---|---|
| date | 日付 | 行動日 |
| actionType | 文字列 | "公務" or "私事" |
| taskName | 文字列 | タスク名 |
| target | 文字列 | 対象（村名など） |
| result | 文字列 | 結果テキスト |

### 9.5 MonthlySummary

| フィールド名 | 型 | 説明 |
|---|---|---|
| year | 整数 | 年 |
| month | 整数 | 月 |
| publicDutyCount | 整数 | 公務実行回数 |
| achievementMilitaryGain | 整数 | 軍事功増分 |
| achievementPoliticalGain | 整数 | 政務功増分 |
| achievementSecretGain | 整数 | 密功増分 |
| evaluationChange | 整数 | 評価変化 |
| incomeTotal | 整数 | 収入合計 |
| expenseTotal | 整数 | 支出合計 |

### 9.6 GameState

| フィールド名 | 型 | 説明 |
|---|---|---|
| currentDate | 日付 | 現在日付 |
| hasPublicDutyThisMonth | 真偽値 | 当月公務実施フラグ |
| player | Player | プレイヤーデータ |
| villageA | Village | 村Aデータ |
| villageB | Village | 村Bデータ |
| lord | Lord | 主君データ |
| dailyLogs | DailyLog[] | 日次ログ配列 |

---

## 10. 将来拡張時の注意点

### 10.1 データ構造の拡張余地

以下のフィールドは将来拡張を見越して予約しておく（v0.4では未使用）：

* Player.retainers: 家臣団配列（v0.5以降）
* Village.industry: 産業枠配列（v0.5以降）
* Village.specialProduct: 名産品（v0.5以降）
* Player.connections: 人脈データ（v0.5以降）

### 10.2 公務タスクのカテゴリ拡張

v0.5以降で以下を追加可能：

* 評定カテゴリ（会議参加）
* 主命カテゴリ（特命任務）
* 戦闘前任務カテゴリ（出陣準備）

これらを見越して、公務タスクに`category`フィールドを持たせる。

### 10.3 月次処理の拡張

v0.5以降で以下を追加可能：

* 人口自然増減
* 治安自然変動
* 家臣成長
* 商人信用集計
* 貸し借りの月次整理

### 10.4 UI画面の追加

v0.5以降で以下を追加可能：

* 家臣団管理画面
* 商人取引画面（詳細版）
* 評定画面
* 出世イベント画面

---

## 11. エッジケース仕様

### 11.1 所持金が負数になる場合

* 許容する（借金状態）
* ゲームオーバーにはしない
* 月次サマリーで警告表示のみ

### 11.2 治安・開発度の上限

* v0.4では上限を設けない
* 将来拡張で上限を設定可能

### 11.3 功績の上限

* 上限なし
* 整数型の範囲内で蓄積

### 11.4 評価の上限

* v0.4では上限を設けない
* 将来拡張で上限を設定可能

---

## 12. 初期化処理

### 12.1 ゲーム開始時の初期状態

* **Player**:
  * name: "田中太郎"
  * affiliation: "織田家（羽柴家）"
  * rank: "書役"
  * role: "書役"
  * money: 100
  * evaluation: 0
  * favor: 0
  * achievementMilitary: 0
  * achievementPolitical: 0
  * achievementSecret: 0

* **VillageA**:
  * name: "村A"
  * population: 1000
  * security: 50
  * income: 100
  * development: 10

* **VillageB**:
  * name: "村B"
  * population: 500
  * security: 30
  * income: 50
  * development: 5

* **Lord**:
  * name: "羽柴秀吉"

* **GameState**:
  * currentDate: 1587年3月12日
  * hasPublicDutyThisMonth: false
  * dailyLogs: 空配列

---

## 13. v0.3との互換性

### 13.1 既存UI画面の維持

v0.3で実装済みの以下の画面構造は変更しない：

* メイン画面（日常行動）
* 村ステータス画面（村A/村B）
* 月次サマリー画面

### 13.2 追加要素の表示

既存画面に以下を追加表示：

* **メイン画面**:
  * 功績（軍事功/政務功/密功）
  * 評価
  * 貸し

* **月次サマリー画面**:
  * 功績増分
  * 評価変化
  * 公務回数

### 13.3 既存データ構造の拡張

v0.3のPlayer, Villageモデルにフィールドを追加する形で実装。既存フィールドは削除しない。

---

## 14. 実装優先度

v0.4の実装は以下の優先度で進める：

### 優先度1（必須）

* 功績3系統の管理
* 公務タスク6種の実装
* 私事タスク4種の実装
* 月次処理の拡張（評価更新）
* 月次サマリーの拡張

### 優先度2（重要）

* 貸しシステムの簡易実装
* DailyLogの記録
* 日付進行ロジックの安定化

### 優先度3（推奨）

* エラーハンドリング
* データ検証
* 将来拡張用フィールドの予約

---

**仕様書作成完了。次の指示を待つ。**
